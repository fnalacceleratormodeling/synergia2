var data = {lines:[
{"lineNum":"    1","line":"#ifndef FF_ALGORITHM_H"},
{"lineNum":"    2","line":"#define FF_ALGORITHM_H"},
{"lineNum":"    3","line":""},
{"lineNum":"    4","line":"#include <cmath>"},
{"lineNum":"    5","line":"#include <limits>"},
{"lineNum":"    6","line":"#include <complex>"},
{"lineNum":"    7","line":"#include <stdexcept>"},
{"lineNum":"    8","line":""},
{"lineNum":"    9","line":"//#include \"basic_toolkit/PhysicsConstants.h\""},
{"lineNum":"   10","line":"#include \"synergia/foundation/physical_constants.h\""},
{"lineNum":"   11","line":"#include \"synergia/foundation/math_constants.h\""},
{"lineNum":"   12","line":"#include \"synergia/utils/kokkos_types.h\""},
{"lineNum":"   13","line":""},
{"lineNum":"   14","line":"#include <Kokkos_Core.hpp>"},
{"lineNum":"   15","line":""},
{"lineNum":"   16","line":"#define LIBFF_USE_GSV 1"},
{"lineNum":"   17","line":""},
{"lineNum":"   18","line":"inline bool close_to_zero(double v)"},
{"lineNum":"   19","line":"{ return fabs(v) < 1e-13; }","class":"lineNoCov","hits":"0","possible_hits":"17",},
{"lineNum":"   20","line":""},
{"lineNum":"   21","line":"namespace FF_algorithm"},
{"lineNum":"   22","line":"{"},
{"lineNum":"   23","line":"    using namespace kt;"},
{"lineNum":"   24","line":""},
{"lineNum":"   25","line":"    // default yoshida order and steps"},
{"lineNum":"   26","line":"    constexpr int default_steps = 6;"},
{"lineNum":"   27","line":"    constexpr int default_order = 4;"},
{"lineNum":"   28","line":""},
{"lineNum":"   29","line":""},
{"lineNum":"   30","line":"    template<typename T >"},
{"lineNum":"   31","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"   32","line":"    T invsqrt(T const& x)"},
{"lineNum":"   33","line":"    { return 1.0 / sqrt(x); }"},
{"lineNum":"   34","line":""},
{"lineNum":"   35","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"   36","line":"    constexpr double quiet_nan()"},
{"lineNum":"   37","line":"    {"},
{"lineNum":"   38","line":"#ifdef Kokkos_ENABLE_CUDA"},
{"lineNum":"   39","line":"        return nan(\"\");"},
{"lineNum":"   40","line":"#else"},
{"lineNum":"   41","line":"        return std::numeric_limits<double>::quiet_NaN();"},
{"lineNum":"   42","line":"#endif"},
{"lineNum":"   43","line":"    }"},
{"lineNum":"   44","line":""},
{"lineNum":"   45","line":"    // exact solution for drift spaces"},
{"lineNum":"   46","line":"    template <typename T>"},
{"lineNum":"   47","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"   48","line":"    void drift_unit"},
{"lineNum":"   49","line":"      (T & x, T const& xp, T & y, T const& yp, T & cdt, T const& dpop,"},
{"lineNum":"   50","line":"       double length, double reference_momentum, double m, double reference_cdt)"},
{"lineNum":"   51","line":"    {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   52","line":"        T uni(1.0);"},
{"lineNum":"   53","line":"        T sig((0.0<length) - (length<0.0));","class":"lineNoCov","hits":"0","possible_hits":"62",},
{"lineNum":"   54","line":""},
{"lineNum":"   55","line":"        T vl(length);"},
{"lineNum":"   56","line":"        T vm(m);"},
{"lineNum":"   57","line":"        T vrm(reference_momentum);"},
{"lineNum":"   58","line":"        T vrc(reference_cdt);"},
{"lineNum":"   59","line":""},
{"lineNum":"   60","line":"        T dp = dpop + uni;","class":"lineNoCov","hits":"0","possible_hits":"42",},
{"lineNum":"   61","line":"        T inv_npz = uni / sqrt(dp * dp - xp * xp - yp * yp);","class":"lineNoCov","hits":"0","possible_hits":"57",},
{"lineNum":"   62","line":"        T lxpr = xp * vl * inv_npz;","class":"lineNoCov","hits":"0","possible_hits":"51",},
{"lineNum":"   63","line":"        T lypr = yp * vl * inv_npz;","class":"lineNoCov","hits":"0","possible_hits":"43",},
{"lineNum":"   64","line":"        T D2 = lxpr * lxpr + vl * vl + lypr * lypr;","class":"lineNoCov","hits":"0","possible_hits":"51",},
{"lineNum":"   65","line":"        T p = dp * vrm;","class":"lineNoCov","hits":"0","possible_hits":"42",},
{"lineNum":"   66","line":"        T E2 = p * p + vm * vm;","class":"lineNoCov","hits":"0","possible_hits":"43",},
{"lineNum":"   67","line":"        //T beta2 = p*p / E2;"},
{"lineNum":"   68","line":"        T ibeta2 = E2 / (p * p);","class":"lineNoCov","hits":"0","possible_hits":"42",},
{"lineNum":"   69","line":"        x = x + lxpr;","class":"lineNoCov","hits":"0","possible_hits":"129",},
{"lineNum":"   70","line":"        y = y + lypr;","class":"lineNoCov","hits":"0","possible_hits":"123",},
{"lineNum":"   71","line":"        //cdt += sqrt(D2 / beta2) - reference_cdt;"},
{"lineNum":"   72","line":"        cdt = cdt + sig * sqrt(D2 * ibeta2) - vrc;","class":"lineNoCov","hits":"0","possible_hits":"152",},
{"lineNum":"   73","line":"    }","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"   74","line":""},
{"lineNum":"   75","line":"    template <typename T>"},
{"lineNum":"   76","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"   77","line":"    void slot_unit("},
{"lineNum":"   78","line":"            T & x, T & xp, T & y, T & yp, T & cdt, T & dpop,"},
{"lineNum":"   79","line":"            double ct, double st, double pref, double m)"},
{"lineNum":"   80","line":"    {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   81","line":"        const T uni(1.0);"},
{"lineNum":"   82","line":""},
{"lineNum":"   83","line":"        const T vct(ct);"},
{"lineNum":"   84","line":"        const T vst(st);"},
{"lineNum":"   85","line":"        const T vpref(pref);"},
{"lineNum":"   86","line":"        const T vm(m);"},
{"lineNum":"   87","line":""},
{"lineNum":"   88","line":"        T r0 = x;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   89","line":"        T r1 = y;"},
{"lineNum":"   90","line":"        T r2 = 0.0;"},
{"lineNum":"   91","line":""},
{"lineNum":"   92","line":"        T zp = sqrt((dpop+uni)*(dpop+uni) - xp * xp - yp * yp);","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":"   93","line":""},
{"lineNum":"   94","line":"        T p = (dpop+uni) * vpref;","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"   95","line":"        T e = sqrt(p*p + vm*vm);","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"   96","line":""},
{"lineNum":"   97","line":"        T b0 = xp * vpref / e;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   98","line":"        T b1 = yp * vpref / e;","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":"   99","line":"        T b2 = zp * vpref / e;","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  100","line":""},
{"lineNum":"  101","line":"        T bp = vst * b0 + vct * b2;","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":"  102","line":""},
{"lineNum":"  103","line":"        T tau = -x * vst / bp;","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  104","line":""},
{"lineNum":"  105","line":"        r0 = x + tau * b0;","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  106","line":"        r1 = y + tau * b1;","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  107","line":"        r2 =     tau * b2;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  108","line":""},
{"lineNum":"  109","line":"        x = r0 * vct - r2 * vst;","class":"lineNoCov","hits":"0","possible_hits":"8",},
{"lineNum":"  110","line":"        y = r1;","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":"  111","line":""},
{"lineNum":"  112","line":"        cdt = cdt + tau;","class":"lineNoCov","hits":"0","possible_hits":"9",},
{"lineNum":"  113","line":""},
{"lineNum":"  114","line":"        xp = xp * vct - zp * vst;","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":"  115","line":"        yp = yp;"},
{"lineNum":"  116","line":"    }","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  117","line":""},
{"lineNum":"  118","line":"    template <typename T>"},
{"lineNum":"  119","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  120","line":"    void edge_unit"},
{"lineNum":"  121","line":"      (T const & y, T & yp, T k)"},
{"lineNum":"  122","line":"    {"},
{"lineNum":"  123","line":"        yp = yp - k * y;"},
{"lineNum":"  124","line":"    }"},
{"lineNum":"  125","line":""},
{"lineNum":"  126","line":"    template <typename T>"},
{"lineNum":"  127","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  128","line":"    void edge_unit"},
{"lineNum":"  129","line":"      (T const & y, T & xp, T & yp, double kx, double ky, char)"},
{"lineNum":"  130","line":"    {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  131","line":"        const T vkx(kx);"},
{"lineNum":"  132","line":"        const T vky(ky);"},
{"lineNum":"  133","line":""},
{"lineNum":"  134","line":"        yp = yp - vkx * y;","class":"lineNoCov","hits":"0","possible_hits":"10",},
{"lineNum":"  135","line":"        xp = xp + vky * y;","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":"  136","line":"    }","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  137","line":""},
{"lineNum":"  138","line":"    template <typename T>"},
{"lineNum":"  139","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  140","line":"    void edge_unit"},
{"lineNum":"  141","line":"      (T const & y, T & xp, T & yp, T const & dpop, T k)"},
{"lineNum":"  142","line":"    {"},
{"lineNum":"  143","line":"        const T uni(1.0);"},
{"lineNum":"  144","line":""},
{"lineNum":"  145","line":"        T zp = sqrt((dpop+uni)*(dpop+uni) - xp * xp - yp * yp);"},
{"lineNum":"  146","line":""},
{"lineNum":"  147","line":"        T xxp = xp;"},
{"lineNum":"  148","line":"        T yyp = yp;"},
{"lineNum":"  149","line":""},
{"lineNum":"  150","line":"        yp = yp - (xxp / zp) * k * y;"},
{"lineNum":"  151","line":"        xp = xp + (yyp / zp) * k * y;"},
{"lineNum":"  152","line":"    }"},
{"lineNum":"  153","line":""},
{"lineNum":"  154","line":"    // exact solution for dipole without high order combined functions"},
{"lineNum":"  155","line":"    template <typename T>"},
{"lineNum":"  156","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  157","line":"    void dipole_unit"},
{"lineNum":"  158","line":"      (T & x, T & xp, T & y, T & yp, T & cdt, T const & dpop, double l, double k0)"},
{"lineNum":"  159","line":"    {"},
{"lineNum":"  160","line":"        T xp1 = xp - k0 * l / (dpop + 1.0);"},
{"lineNum":"  161","line":"        T yp1 = yp;"},
{"lineNum":"  162","line":""},
{"lineNum":"  163","line":"        T poeb = (dpop + 1.0) / k0;   // p/eB"},
{"lineNum":"  164","line":""},
{"lineNum":"  165","line":"        x += poeb * ( sqrt(1 - xp1*xp1 - yp1*yp1) - sqrt(1 - xp*xp - yp*yp) );"},
{"lineNum":"  166","line":"        y += poeb * yp * ( atan( xp/sqrt(1-xp*xp-yp*yp) ) - atan( xp1/sqrt(1-xp1*xp1-yp1*yp1) ) );"},
{"lineNum":"  167","line":""},
{"lineNum":"  168","line":"        xp = xp1;"},
{"lineNum":"  169","line":"    }"},
{"lineNum":"  170","line":""},
{"lineNum":"  171","line":"    // exact solution for dipoles, comes from CHEF"},
{"lineNum":"  172","line":"    template <typename T>"},
{"lineNum":"  173","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  174","line":"    void bend_complete"},
{"lineNum":"  175","line":"      (T & x, T & xp, T & y, T & yp, T & cdt, T const& dpop,"},
{"lineNum":"  176","line":"       double dphi, double strength, double p_ref, double m, double cdt_ref,"},
{"lineNum":"  177","line":"       Kokkos::complex<double> phase, Kokkos::complex<double> term)"},
{"lineNum":"  178","line":"    {"},
{"lineNum":"  179","line":"        typedef Kokkos::complex<T> CT;"},
{"lineNum":"  180","line":""},
{"lineNum":"  181","line":"        const T uni(1.0);"},
{"lineNum":"  182","line":""},
{"lineNum":"  183","line":"        T p0 = p_ref;"},
{"lineNum":"  184","line":"        T p  = p_ref * (dpop + 1.0);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  185","line":"        T E0 = sqrt(p0 * p0 + m * m);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  186","line":"        T E  = sqrt(p * p + m * m);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  187","line":""},
{"lineNum":"  188","line":"        T igamma = m / E0;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  189","line":"        T ibeta  = uni / sqrt(uni - igamma * igamma);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  190","line":""},
{"lineNum":"  191","line":"        T csq = pconstants::c * pconstants::c * 1e-9;"},
{"lineNum":"  192","line":"        T psq = (dpop + 1.0) * (dpop + 1.0);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  193","line":""},
{"lineNum":"  194","line":"        T Ef = uni / sqrt(psq + igamma * igamma * ibeta * ibeta);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  195","line":""},
{"lineNum":"  196","line":"        T beta1 = Ef * xp;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  197","line":"        T beta2 = Ef * yp;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  198","line":"        T beta3 = Ef * sqrt( (dpop + 1.0) * (dpop + 1.0) - xp * xp - yp * yp );","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  199","line":""},
{"lineNum":"  200","line":"        CT ui  = CT(0.0, x);"},
{"lineNum":"  201","line":"        CT vui = CT(pconstants::c * beta3, pconstants::c * beta1);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  202","line":""},
{"lineNum":"  203","line":"        T iomega = E / (csq * strength);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  204","line":""},
{"lineNum":"  205","line":"        CT bi = CT(0.0, 1.0) * vui * iomega - ui;"},
{"lineNum":"  206","line":"        CT bf = bi * phase + term;"},
{"lineNum":"  207","line":""},
{"lineNum":"  208","line":"        T rho = pconstants::c * sqrt( beta1 * beta1 + beta3 * beta3 ) * iomega;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  209","line":""},
{"lineNum":"  210","line":"        T dthmphi = asin(bi.real() / rho) - asin(bf.real() / rho);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  211","line":""},
{"lineNum":"  212","line":"        CT expf = Kokkos::exp( CT(0.0, dthmphi) );"},
{"lineNum":"  213","line":"        CT vuf  = vui * expf;"},
{"lineNum":"  214","line":"        CT uf   = (ui + bi) * expf - bf;"},
{"lineNum":"  215","line":""},
{"lineNum":"  216","line":"        T dtheta = dthmphi + dphi;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  217","line":"        T ncdt = - pconstants::c * dtheta * iomega;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  218","line":""},
{"lineNum":"  219","line":"        x    = uf.imag();"},
{"lineNum":"  220","line":"        y   += beta2 * ncdt;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  221","line":"        cdt += ncdt - cdt_ref;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  222","line":"        xp   = vuf.imag() / (Ef * pconstants::c);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  223","line":"    }"},
{"lineNum":"  224","line":""},
{"lineNum":"  225","line":"    template <typename T>"},
{"lineNum":"  226","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  227","line":"    void bend_unit(T& x, T& xp, T& y, T& yp, T& cdt, T const& dpop,"},
{"lineNum":"  228","line":"            double theta, double strength, double p_ref,"},
{"lineNum":"  229","line":"            double m, double cdt_ref,"},
{"lineNum":"  230","line":"            Kokkos::complex<double> phase,"},
{"lineNum":"  231","line":"            Kokkos::complex<double> term)"},
{"lineNum":"  232","line":"    {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  233","line":"        typedef Kokkos::complex<T> CT;"},
{"lineNum":"  234","line":""},
{"lineNum":"  235","line":"        const T uni(1.0);"},
{"lineNum":"  236","line":"        const T tc(pconstants::c);"},
{"lineNum":"  237","line":""},
{"lineNum":"  238","line":"        const T vtheta(theta);"},
{"lineNum":"  239","line":"        const T vstrength(strength);"},
{"lineNum":"  240","line":"        const T vp_ref(p_ref);"},
{"lineNum":"  241","line":"        const T vm(m);"},
{"lineNum":"  242","line":"        const T vcdt_ref(cdt_ref);"},
{"lineNum":"  243","line":""},
{"lineNum":"  244","line":"        T p0 = vp_ref;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  245","line":"        T p  = vp_ref * (dpop + uni);","class":"lineNoCov","hits":"0","possible_hits":"11",},
{"lineNum":"  246","line":"        T E0 = sqrt(p0 * p0 + vm * vm);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  247","line":"        T E  = sqrt(p * p + vm * vm);","class":"lineNoCov","hits":"0","possible_hits":"11",},
{"lineNum":"  248","line":""},
{"lineNum":"  249","line":"        T igamma = vm / E0;","class":"lineNoCov","hits":"0","possible_hits":"10",},
{"lineNum":"  250","line":"        T ibeta  = uni / sqrt(uni - igamma * igamma);","class":"lineNoCov","hits":"0","possible_hits":"11",},
{"lineNum":"  251","line":""},
{"lineNum":"  252","line":"        T csq = T(pconstants::c * pconstants::c * 1e-9);"},
{"lineNum":"  253","line":"        T psq = (dpop + uni) * (dpop + uni);","class":"lineNoCov","hits":"0","possible_hits":"11",},
{"lineNum":"  254","line":""},
{"lineNum":"  255","line":"        T Ef = uni / sqrt(psq + igamma * igamma * ibeta * ibeta);","class":"lineNoCov","hits":"0","possible_hits":"11",},
{"lineNum":"  256","line":""},
{"lineNum":"  257","line":"        T beta1 = Ef * xp;","class":"lineNoCov","hits":"0","possible_hits":"10",},
{"lineNum":"  258","line":"        T beta2 = Ef * yp;","class":"lineNoCov","hits":"0","possible_hits":"10",},
{"lineNum":"  259","line":"        T beta3 = Ef * sqrt( (dpop + uni) * (dpop + uni) - xp * xp - yp * yp );","class":"lineNoCov","hits":"0","possible_hits":"11",},
{"lineNum":"  260","line":""},
{"lineNum":"  261","line":"        //CT ui  = CT(0.0, x);"},
{"lineNum":"  262","line":"        T ui_r = 0.0;"},
{"lineNum":"  263","line":"        T ui_i = x;","class":"lineNoCov","hits":"0","possible_hits":"13",},
{"lineNum":"  264","line":""},
{"lineNum":"  265","line":"        //CT vui = CT(tc * beta3, tc * beta1);"},
{"lineNum":"  266","line":"        T vui_r = tc * beta3;","class":"lineNoCov","hits":"0","possible_hits":"10",},
{"lineNum":"  267","line":"        T vui_i = tc * beta1;","class":"lineNoCov","hits":"0","possible_hits":"10",},
{"lineNum":"  268","line":""},
{"lineNum":"  269","line":"        T iomega = E / (csq * vstrength);","class":"lineNoCov","hits":"0","possible_hits":"10",},
{"lineNum":"  270","line":""},
{"lineNum":"  271","line":"        //CT bi = CT(0.0, 1.0) * vui * iomega - ui;"},
{"lineNum":"  272","line":"        T bi_r = -vui_i * iomega - ui_r;","class":"lineNoCov","hits":"0","possible_hits":"11",},
{"lineNum":"  273","line":"        T bi_i =  vui_r * iomega - ui_i;","class":"lineNoCov","hits":"0","possible_hits":"10",},
{"lineNum":"  274","line":""},
{"lineNum":"  275","line":"        //CT bf = bi * phase + term;"},
{"lineNum":"  276","line":"        T phase_r(phase.real()); T phase_i(phase.imag());"},
{"lineNum":"  277","line":"        T bf_r = bi_r * phase_r - bi_i * phase_i + T(term.real());","class":"lineNoCov","hits":"0","possible_hits":"14",},
{"lineNum":"  278","line":"        T bf_i = bi_r * phase_i + bi_i * phase_r + T(term.imag());","class":"lineNoCov","hits":"0","possible_hits":"12",},
{"lineNum":"  279","line":""},
{"lineNum":"  280","line":"        T rho = tc * sqrt( beta1 * beta1 + beta3 * beta3 ) * iomega;","class":"lineNoCov","hits":"0","possible_hits":"12",},
{"lineNum":"  281","line":""},
{"lineNum":"  282","line":"        //T dthmphi = asin(bi.real() / rho) - asin(bf.real() / rho);"},
{"lineNum":"  283","line":"        T dthmphi = asin(bi_r / rho) - asin(bf_r / rho);","class":"lineNoCov","hits":"0","possible_hits":"12",},
{"lineNum":"  284","line":""},
{"lineNum":"  285","line":"        //CT expf = Kokkos::exp( CT(0.0, dthmphi) );"},
{"lineNum":"  286","line":"        T expf_r = cos(dthmphi);","class":"lineNoCov","hits":"0","possible_hits":"10",},
{"lineNum":"  287","line":"        T expf_i = sin(dthmphi);","class":"lineNoCov","hits":"0","possible_hits":"10",},
{"lineNum":"  288","line":""},
{"lineNum":"  289","line":"        //CT vuf  = vui * expf;"},
{"lineNum":"  290","line":"        T vuf_i = vui_r * expf_i + vui_i * expf_r;","class":"lineNoCov","hits":"0","possible_hits":"11",},
{"lineNum":"  291","line":""},
{"lineNum":"  292","line":"        //CT uf   = (ui + bi) * expf - bf;"},
{"lineNum":"  293","line":"        T uf_i = (ui_r+bi_r)*expf_i + (ui_i+bi_i)*expf_r - bf_i;","class":"lineNoCov","hits":"0","possible_hits":"11",},
{"lineNum":"  294","line":""},
{"lineNum":"  295","line":"        T dtheta = dthmphi + vtheta;","class":"lineNoCov","hits":"0","possible_hits":"10",},
{"lineNum":"  296","line":"        T ncdt = -tc * dtheta * iomega;","class":"lineNoCov","hits":"0","possible_hits":"11",},
{"lineNum":"  297","line":""},
{"lineNum":"  298","line":"        //x = uf.imag();"},
{"lineNum":"  299","line":"        x = uf_i;","class":"lineNoCov","hits":"0","possible_hits":"12",},
{"lineNum":"  300","line":""},
{"lineNum":"  301","line":"        //xp = vuf.imag() / (Ef * tc);"},
{"lineNum":"  302","line":"        xp = vuf_i / (Ef * tc);","class":"lineNoCov","hits":"0","possible_hits":"11",},
{"lineNum":"  303","line":""},
{"lineNum":"  304","line":"        y   = y + beta2 * ncdt;","class":"lineNoCov","hits":"0","possible_hits":"12",},
{"lineNum":"  305","line":"        cdt = cdt + ncdt - vcdt_ref;","class":"lineNoCov","hits":"0","possible_hits":"12",},
{"lineNum":"  306","line":"    }","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  307","line":""},
{"lineNum":"  308","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  309","line":"    Kokkos::complex<double> bend_unit_phase(double theta)"},
{"lineNum":"  310","line":"    { return Kokkos::exp( Kokkos::complex<double>(0.0, theta) ); }"},
{"lineNum":"  311","line":""},
{"lineNum":"  312","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  313","line":"    Kokkos::complex<double> bend_edge_phase(double theta)"},
{"lineNum":"  314","line":"    { return Kokkos::exp( Kokkos::complex<double>(0.0, -theta) ); }"},
{"lineNum":"  315","line":""},
{"lineNum":"  316","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  317","line":"    Kokkos::complex<double> bend_unit_term(double r0, double theta)"},
{"lineNum":"  318","line":"    { return Kokkos::complex<double>(0.0, r0) * Kokkos::complex<double>(1.0 - cos(theta), -sin(theta)); }","class":"lineNoCov","hits":"0","possible_hits":"12",},
{"lineNum":"  319","line":""},
{"lineNum":"  320","line":"    template <typename T>"},
{"lineNum":"  321","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  322","line":"    void bend_edge(T& x, T& xp, T& y, T& yp, T& cdt, T const& dpop,"},
{"lineNum":"  323","line":"            T e, Kokkos::complex<double> phase,"},
{"lineNum":"  324","line":"            T strength, T p_ref, T m)"},
{"lineNum":"  325","line":"    {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  326","line":"        typedef Kokkos::complex<T> CT;"},
{"lineNum":"  327","line":""},
{"lineNum":"  328","line":"        const T uni(1.0);"},
{"lineNum":"  329","line":"        const T tc(pconstants::c);"},
{"lineNum":"  330","line":""},
{"lineNum":"  331","line":"        T p0 = p_ref;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  332","line":"        T p  = p_ref * (dpop + uni);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  333","line":"        T E0 = sqrt(p0 * p0 + m * m);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  334","line":"        T E  = sqrt(p * p + m * m);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  335","line":""},
{"lineNum":"  336","line":"        T igamma = m / E0;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  337","line":"        T ibeta  = uni / sqrt(uni - igamma * igamma);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  338","line":""},
{"lineNum":"  339","line":"        T csq = T(pconstants::c * pconstants::c * 1e-9);"},
{"lineNum":"  340","line":"        T psq = (dpop + uni) * (dpop + uni);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  341","line":""},
{"lineNum":"  342","line":"        T Ef = uni / sqrt(psq + igamma * igamma * ibeta * ibeta);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  343","line":""},
{"lineNum":"  344","line":"        T beta1 = Ef * xp;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  345","line":"        T beta2 = Ef * yp;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  346","line":"        T beta3 = Ef * sqrt( (dpop + uni) * (dpop + uni) - xp * xp - yp * yp );","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  347","line":""},
{"lineNum":"  348","line":"        //CT ui  = CT(0.0, x);"},
{"lineNum":"  349","line":"        T ui_r = 0.0;"},
{"lineNum":"  350","line":"        T ui_i = x;","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  351","line":""},
{"lineNum":"  352","line":"        //CT vui = CT(pconstants::c * beta3, pconstants::c * beta1);"},
{"lineNum":"  353","line":"        T vui_r = tc * beta3;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  354","line":"        T vui_i = tc * beta1;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  355","line":""},
{"lineNum":"  356","line":"        T iomega = E / (csq * strength);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  357","line":""},
{"lineNum":"  358","line":"        //CT bi = CT(0.0, 1.0) * vui * iomega - ui;"},
{"lineNum":"  359","line":"        T bi_r = -vui_i * iomega - ui_r;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  360","line":"        T bi_i =  vui_r * iomega - ui_i;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  361","line":""},
{"lineNum":"  362","line":"        //CT bf = bi * phase;"},
{"lineNum":"  363","line":"        T phase_r(phase.real()); T phase_i(phase.imag());"},
{"lineNum":"  364","line":"        T bf_r = bi_r * phase_r - bi_i * phase_i;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  365","line":"        T bf_i = bi_r * phase_i + bi_i * phase_r;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  366","line":""},
{"lineNum":"  367","line":"        T rho = tc * sqrt( beta1 * beta1 + beta3 * beta3 ) * iomega;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  368","line":""},
{"lineNum":"  369","line":"        //T dthmphi = asin(bi.real() / rho) - asin(bf.real() / rho);"},
{"lineNum":"  370","line":"        T dthmphi = asin(bi_r / rho) - asin(bf_r / rho);","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  371","line":""},
{"lineNum":"  372","line":"        //CT expf = Kokkos::exp( CT(0.0, dthmphi) );"},
{"lineNum":"  373","line":"        T expf_r = cos(dthmphi);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  374","line":"        T expf_i = sin(dthmphi);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  375","line":""},
{"lineNum":"  376","line":"        //CT vuf  = vui * expf;"},
{"lineNum":"  377","line":"        T vuf_i = vui_r * expf_i + vui_i * expf_r;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  378","line":""},
{"lineNum":"  379","line":"        //CT uf   = (ui + bi) * expf - bf;"},
{"lineNum":"  380","line":"        T uf_i = (ui_r+bi_r)*expf_i + (ui_i+bi_i)*expf_r - bf_i;","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  381","line":""},
{"lineNum":"  382","line":"        T dtheta = dthmphi + e;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  383","line":"        T ncdt = - tc * dtheta * iomega;","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  384","line":""},
{"lineNum":"  385","line":"        //x = uf.imag();"},
{"lineNum":"  386","line":"        x = uf_i;","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  387","line":""},
{"lineNum":"  388","line":"        //xp = vuf.imag() / (Ef * pconstants::c);"},
{"lineNum":"  389","line":"        xp = vuf_i / (Ef * tc);","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  390","line":""},
{"lineNum":"  391","line":"        y = y + beta2 * ncdt;","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":"  392","line":"        cdt = cdt + ncdt;","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  393","line":"    }","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  394","line":""},
{"lineNum":"  395","line":"// thin_cf_quadrupole_unit is not used.  It follows expressions in"},
{"lineNum":"  396","line":"// CHEF\'s InducedKickPropagators which are now contained in"},
{"lineNum":"  397","line":"// thin_cf_quadrupole_b{x|y} and retained here for historical reference"},
{"lineNum":"  398","line":"    template <typename T>"},
{"lineNum":"  399","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  400","line":"    void thin_cf_quadrupole_unit"},
{"lineNum":"  401","line":"      (T const& x, T& xp, T const& y, T& yp, double r0, double const * kL)"},
{"lineNum":"  402","line":"    {"},
{"lineNum":"  403","line":"        T vk0(kL[0]);"},
{"lineNum":"  404","line":"        T vk1(kL[1]);"},
{"lineNum":"  405","line":""},
{"lineNum":"  406","line":"        T alf = x / r0;"},
{"lineNum":"  407","line":""},
{"lineNum":"  408","line":"#define MODEL 10"},
{"lineNum":"  409","line":""},
{"lineNum":"  410","line":"#if MODEL==10"},
{"lineNum":"  411","line":"        T Bx = r0 * ( y / (r0 + x) );"},
{"lineNum":"  412","line":"        T By = r0 * log(1.0 + alf);"},
{"lineNum":"  413","line":"        xp = xp - vk0 * By * (1.0 + alf);"},
{"lineNum":"  414","line":"        yp = yp + vk0 * Bx * (1.0 + alf);"},
{"lineNum":"  415","line":"#elif MODEL==11"},
{"lineNum":"  416","line":"        T Bx = y * (1.0 - alf + alf * alf);"},
{"lineNum":"  417","line":"        T By = x * (1.0 - 0.5 * alf + alf * alf / 3.0);"},
{"lineNum":"  418","line":"        xp = xp - vk0 * By * (1.0 + alf);"},
{"lineNum":"  419","line":"        yp = yp + vk0 * Bx * (1.0 + alf);"},
{"lineNum":"  420","line":"#elif MODEL==12"},
{"lineNum":"  421","line":"        T Bx = y * (1.0 - alf);"},
{"lineNum":"  422","line":"        T By = x * (1.0 - 0.5 * alf);"},
{"lineNum":"  423","line":"        xp = xp - vk0 * By * (1.0 + alf);"},
{"lineNum":"  424","line":"        yp = yp + vk0 * Bx * (1.0 + alf);"},
{"lineNum":"  425","line":"#elif MODEL==13"},
{"lineNum":"  426","line":"        T Bx = y;"},
{"lineNum":"  427","line":"        T By = x;"},
{"lineNum":"  428","line":"        xp = xp - vk0 * By * (1.0 + alf);"},
{"lineNum":"  429","line":"        yp = yp + vk0 * Bx * (1.0 + alf);"},
{"lineNum":"  430","line":"#elif MODEL==14"},
{"lineNum":"  431","line":"        T Bx = y;"},
{"lineNum":"  432","line":"        T By = x;"},
{"lineNum":"  433","line":"        xp = xp - vk0 * By;"},
{"lineNum":"  434","line":"        yp = yp + vk0 * Bx;"},
{"lineNum":"  435","line":"#endif"},
{"lineNum":"  436","line":"    }"},
{"lineNum":"  437","line":""},
{"lineNum":"  438","line":"    // the expressions in thin_cf_quadrupole_b{x|y} come from"},
{"lineNum":"  439","line":"    // Zolkin, Sector magnets or transverse electromagnetic fields in cylindrical coordinates,"},
{"lineNum":"  440","line":"    // Phys.Rev.Accel.Beams 20 (2017) no.4, 043501 Table XIII"},
{"lineNum":"  441","line":"    template <typename T>"},
{"lineNum":"  442","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  443","line":"    T thin_cf_quadrupole_bx (T const& x, T const& y, T const& r0)"},
{"lineNum":"  444","line":"    { return r0 * y / (r0 + x); }"},
{"lineNum":"  445","line":""},
{"lineNum":"  446","line":"    template <typename T>"},
{"lineNum":"  447","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  448","line":"    T thin_cf_quadrupole_by (T const& x, T const& y, T const& r0, T const& alf)"},
{"lineNum":"  449","line":"    { return r0 * log(T(1.0) + alf); }"},
{"lineNum":"  450","line":""},
{"lineNum":"  451","line":"    // the expressions in thin_cf_sectupole_b{x|y} come from"},
{"lineNum":"  452","line":"    // Zolkin, Sector magnets or transverse electromagnetic fields in cylindrical coordinates,"},
{"lineNum":"  453","line":"    // Phys.Rev.Accel.Beams 20 (2017) no.4, 043501 Table XIII"},
{"lineNum":"  454","line":"    template <typename T>"},
{"lineNum":"  455","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  456","line":"    T thin_cf_sextupole_bx (T const& x, T const& y, T const& r0, T const& alf)"},
{"lineNum":"  457","line":"    { return x * (T(2.0) + alf) * y / (T(1.0) + alf); }"},
{"lineNum":"  458","line":""},
{"lineNum":"  459","line":"    template <typename T>"},
{"lineNum":"  460","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  461","line":"    T thin_cf_sextupole_by (T const& x, T const& y, T const& r0, T const& alf)"},
{"lineNum":"  462","line":"    { return T(0.5) * (x*x + T(2.0)*x*r0) - y*y - r0*r0*log(T(1.0) + alf); }"},
{"lineNum":"  463","line":""},
{"lineNum":"  464","line":"    // combined function sbends kick up to quadrupole"},
{"lineNum":"  465","line":"    template <typename T>"},
{"lineNum":"  466","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  467","line":"    void thin_cf_kick_1"},
{"lineNum":"  468","line":"      (T const& x, T& xp, T const& y, T& yp, double r0, double const * kL)"},
{"lineNum":"  469","line":"    {"},
{"lineNum":"  470","line":"        const T uni(1.0);"},
{"lineNum":"  471","line":""},
{"lineNum":"  472","line":"        T vk1n(kL[0]);"},
{"lineNum":"  473","line":"        T vk1s(kL[1]);"},
{"lineNum":"  474","line":""},
{"lineNum":"  475","line":"        T vr0(r0);"},
{"lineNum":"  476","line":"        T alf = x / vr0;"},
{"lineNum":"  477","line":"        T rho = uni + alf;"},
{"lineNum":"  478","line":""},
{"lineNum":"  479","line":"        //xp = xp - vk1n * rho * thin_cf_quadrupole_by(x, y, vr0, alf);"},
{"lineNum":"  480","line":"        //yp = yp + vk1n * rho * thin_cf_quadrupole_bx(x, y, vr0);"},
{"lineNum":"  481","line":""},
{"lineNum":"  482","line":"        xp = xp - vk1n * rho * vr0 * log(rho)"},
{"lineNum":"  483","line":"                + vk1s * rho * y"},
{"lineNum":"  484","line":"                ;"},
{"lineNum":"  485","line":""},
{"lineNum":"  486","line":"        yp = yp + vk1n * y"},
{"lineNum":"  487","line":"                + vk1s * vr0 * (rho*rho - uni) * T(0.5)"},
{"lineNum":"  488","line":"                ;"},
{"lineNum":"  489","line":"    }"},
{"lineNum":"  490","line":""},
{"lineNum":"  491","line":"    // combined function sbends kick up to sextupole"},
{"lineNum":"  492","line":"    template <typename T>"},
{"lineNum":"  493","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  494","line":"    void thin_cf_kick_2"},
{"lineNum":"  495","line":"      (T const& x, T& xp, T const& y, T& yp, double r0, double const * kL)"},
{"lineNum":"  496","line":"    {"},
{"lineNum":"  497","line":"        const T uni(1.0);"},
{"lineNum":"  498","line":""},
{"lineNum":"  499","line":"        T vk1n(kL[0]);"},
{"lineNum":"  500","line":"        T vk1s(kL[1]);"},
{"lineNum":"  501","line":""},
{"lineNum":"  502","line":"        T vk2n(kL[2]);"},
{"lineNum":"  503","line":"        T vk2s(kL[3]);"},
{"lineNum":"  504","line":""},
{"lineNum":"  505","line":"        T vr0(r0);"},
{"lineNum":"  506","line":"        T alf = x / vr0;"},
{"lineNum":"  507","line":"        T rho = uni + alf;"},
{"lineNum":"  508","line":""},
{"lineNum":"  509","line":"        xp = xp - vk1n * (uni + alf) * thin_cf_quadrupole_by(x, y, vr0, alf)"},
{"lineNum":"  510","line":"                + vk1s * rho * y"},
{"lineNum":"  511","line":"                - vk2n * (uni + alf) * thin_cf_sextupole_by(x, y, vr0, alf) * T(0.5)"},
{"lineNum":"  512","line":"                ;"},
{"lineNum":"  513","line":""},
{"lineNum":"  514","line":"        yp = yp + vk1n * (uni + alf) * thin_cf_quadrupole_bx(x, y, vr0)"},
{"lineNum":"  515","line":"                + vk1s * vr0 * (rho*rho - uni) * T(0.5)"},
{"lineNum":"  516","line":"                + vk2n * (uni + alf) * thin_cf_sextupole_bx(x, y, vr0, alf) * T(0.5)"},
{"lineNum":"  517","line":"                ;"},
{"lineNum":"  518","line":"    }"},
{"lineNum":"  519","line":""},
{"lineNum":"  520","line":"    // F_rn_i is the F_rho of a normal multipole at order i"},
{"lineNum":"  521","line":"    // F_yn_i is the F_ybar (ybar = y/r0) of a normal multipole at order i"},
{"lineNum":"  522","line":"    // F_rs_i is the F_rho of a skew multipole at order i"},
{"lineNum":"  523","line":"    // F_ys_i is the F_ybar (ybar = y/r0) of a skew multipole at order i"},
{"lineNum":"  524","line":"    //"},
{"lineNum":"  525","line":"    // See Zolkin, Sector magnets or transverse electromagnetic fields in cylindrical"},
{"lineNum":"  526","line":"    // coordinates, Phys.Rev.Accel.Beams 20 (2017) no.4, 043501 Table XII"},
{"lineNum":"  527","line":"    template<typename T>"},
{"lineNum":"  528","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  529","line":"    T F_rn_2(T const& rho, T const& y)"},
{"lineNum":"  530","line":"    { return T(-1.0) * (y/rho); }","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  531","line":""},
{"lineNum":"  532","line":"    template<typename T>"},
{"lineNum":"  533","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  534","line":"    T F_rn_3(T const& rho, T const& y)"},
{"lineNum":"  535","line":"    { return T(-0.5) * (y/rho) * (rho*rho - T(1.0)); }","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  536","line":""},
{"lineNum":"  537","line":"    template<typename T>"},
{"lineNum":"  538","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  539","line":"    T F_rn_4(T const& rho, T const& y)"},
{"lineNum":"  540","line":"    { return T(-1.0/6.0) * (y/rho) *","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  541","line":"        (T(-3.0/2.0)*(rho*rho-T(1.0)) - y*y + T(3.0)*rho*rho*log(rho)); }","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":"  542","line":""},
{"lineNum":"  543","line":"    template<typename T>"},
{"lineNum":"  544","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  545","line":"    T F_rn_5(T const& rho, T const& y)"},
{"lineNum":"  546","line":"    { return T(-1.0/12.0) * (y/rho) *","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  547","line":"        ((rho*rho-T(1.0))*(T(3.0/4.0)*(rho*rho+T(1.0))-y*y) - T(3.0)*rho*rho*log(rho)); }","class":"lineNoCov","hits":"0","possible_hits":"9",},
{"lineNum":"  548","line":""},
{"lineNum":"  549","line":""},
{"lineNum":"  550","line":"    template<typename T>"},
{"lineNum":"  551","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  552","line":"    T F_yn_2(T const& rho, T const& y)"},
{"lineNum":"  553","line":"    { return log(rho); }","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  554","line":""},
{"lineNum":"  555","line":"    template<typename T>"},
{"lineNum":"  556","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  557","line":"    T F_yn_3(T const& rho, T const& y)"},
{"lineNum":"  558","line":"    { return T(0.5) * (T(0.5)*(rho*rho-T(1.0)) - y*y - log(rho)); }","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  559","line":""},
{"lineNum":"  560","line":"    template<typename T>"},
{"lineNum":"  561","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  562","line":"    T F_yn_4(T const& rho, T const& y)"},
{"lineNum":"  563","line":"    { return T(-0.25)*(rho*rho-T(1.0)) + T(0.5)*(T(0.5)*(rho*rho+T(1.0)) - y*y)*log(rho); }","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":"  564","line":""},
{"lineNum":"  565","line":"    template<typename T>"},
{"lineNum":"  566","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  567","line":"    T F_yn_5(T const& rho, T const& y)"},
{"lineNum":"  568","line":"    { return T(0.125) * ( T(0.125)*(rho*rho*rho*rho+T(4.0)*rho*rho-T(5.0))","class":"lineNoCov","hits":"0","possible_hits":"9",},
{"lineNum":"  569","line":"                - (rho*rho-T(1.0))*y*y + y*y*y*y","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  570","line":"                - (T(0.5)+rho*rho-T(2.0)*y*y)*log(rho) ); }","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  571","line":""},
{"lineNum":"  572","line":""},
{"lineNum":"  573","line":"    template<typename T>"},
{"lineNum":"  574","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  575","line":"    T F_rs_2(T const& rho, T const& y)"},
{"lineNum":"  576","line":"    { return T(0.5) / rho * (rho*rho - T(1.0)); }","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  577","line":""},
{"lineNum":"  578","line":"    template<typename T>"},
{"lineNum":"  579","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  580","line":"    T F_rs_3(T const& rho, T const& y)"},
{"lineNum":"  581","line":"    { return T(0.5) / rho *","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":"  582","line":"        (T(-0.5)*(rho*rho - T(1.0)) - y*y + rho*rho*log(rho)); }","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  583","line":""},
{"lineNum":"  584","line":"    template<typename T>"},
{"lineNum":"  585","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  586","line":"    T F_rs_4(T const& rho, T const& y)"},
{"lineNum":"  587","line":"    { return T(0.25) / rho *","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  588","line":"        (T(0.25)*(rho*rho*rho*rho-T(1.0)) - (rho*rho-T(1.0))*y*y - rho*rho*log(rho)); }","class":"lineNoCov","hits":"0","possible_hits":"8",},
{"lineNum":"  589","line":""},
{"lineNum":"  590","line":"    template<typename T>"},
{"lineNum":"  591","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  592","line":"    T F_rs_5(T const& rho, T const& y)"},
{"lineNum":"  593","line":"    { return T(0.125) / rho *","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":"  594","line":"        ( T(-0.625)*rho*rho*rho*rho + T(0.5)*rho*rho + T(0.125)","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  595","line":"          + (rho*rho-T(1.0))*y*y + y*y*y*y","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  596","line":"          + (T(1.0)+T(0.5)*rho*rho-T(2.0)*y*y)*rho*rho*log(rho) ); }","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  597","line":""},
{"lineNum":"  598","line":""},
{"lineNum":"  599","line":"    template<typename T>"},
{"lineNum":"  600","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  601","line":"    T F_ys_2(T const& rho, T const& y)"},
{"lineNum":"  602","line":"    { return y; }","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  603","line":""},
{"lineNum":"  604","line":"    template<typename T>"},
{"lineNum":"  605","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  606","line":"    T F_ys_3(T const& rho, T const& y)"},
{"lineNum":"  607","line":"    { return y * log(rho); }","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  608","line":""},
{"lineNum":"  609","line":"    template<typename T>"},
{"lineNum":"  610","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  611","line":"    T F_ys_4(T const& rho, T const& y)"},
{"lineNum":"  612","line":"    { return T(0.5) * y * (T(0.5)*(rho*rho-T(1.0)) - y*y/T(3.0) - log(rho)); }","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  613","line":""},
{"lineNum":"  614","line":"    template<typename T>"},
{"lineNum":"  615","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  616","line":"    T F_ys_5(T const& rho, T const& y)"},
{"lineNum":"  617","line":"    { return T(-0.25) * y * (rho*rho-T(1.0)) +","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":"  618","line":"        T(1.0/6.0) * (T(1.5)*(rho*rho+T(1.0))-y*y) * log(rho); }","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  619","line":""},
{"lineNum":"  620","line":""},
{"lineNum":"  621","line":""},
{"lineNum":"  622","line":"    // combined function sbends kick up to dectapole"},
{"lineNum":"  623","line":"    template <typename T>"},
{"lineNum":"  624","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  625","line":"    void thin_cf_kick_5"},
{"lineNum":"  626","line":"      (T const& x, T& xp, T const& y, T& yp, double r0, double const * kL)"},
{"lineNum":"  627","line":"    {","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  628","line":"        const T uni(1.0);"},
{"lineNum":"  629","line":""},
{"lineNum":"  630","line":"        T vr0(r0);"},
{"lineNum":"  631","line":""},
{"lineNum":"  632","line":"        T rho = uni + x / vr0;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  633","line":"        T ybar = y / vr0;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  634","line":""},
{"lineNum":"  635","line":"        // quadrupole"},
{"lineNum":"  636","line":"        if (kL[0] || kL[1])","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  637","line":"        {"},
{"lineNum":"  638","line":"            T kn(kL[0]);"},
{"lineNum":"  639","line":"            T ks(kL[1]);"},
{"lineNum":"  640","line":""},
{"lineNum":"  641","line":"            xp = xp - kn * rho * vr0 * F_yn_2(rho, ybar)","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":"  642","line":"                    + ks * rho * vr0 * F_ys_2(rho, ybar)","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  643","line":"                    ;"},
{"lineNum":"  644","line":""},
{"lineNum":"  645","line":"            yp = yp - kn * rho * vr0 * F_rn_2(rho, ybar)","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":"  646","line":"                    + ks * rho * vr0 * F_rs_2(rho, ybar)","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  647","line":"                    ;"},
{"lineNum":"  648","line":"        }"},
{"lineNum":"  649","line":""},
{"lineNum":"  650","line":"        // sextupole"},
{"lineNum":"  651","line":"        if (kL[2] || kL[3])","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  652","line":"        {"},
{"lineNum":"  653","line":"            T kn(kL[2]);"},
{"lineNum":"  654","line":"            T ks(kL[3]);"},
{"lineNum":"  655","line":""},
{"lineNum":"  656","line":"            xp = xp - kn * rho * vr0*vr0 * F_yn_3(rho, ybar)","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":"  657","line":"                    + ks * rho * vr0*vr0 * F_ys_3(rho, ybar)","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  658","line":"                    ;"},
{"lineNum":"  659","line":""},
{"lineNum":"  660","line":"            yp = yp - kn * rho * vr0*vr0 * F_rn_3(rho, ybar)","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":"  661","line":"                    + ks * rho * vr0*vr0 * F_rs_3(rho, ybar)","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  662","line":"                    ;"},
{"lineNum":"  663","line":"        }"},
{"lineNum":"  664","line":""},
{"lineNum":"  665","line":"        // octupole"},
{"lineNum":"  666","line":"        if (kL[4] || kL[5])","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  667","line":"        {"},
{"lineNum":"  668","line":"            T kn(kL[4]);"},
{"lineNum":"  669","line":"            T ks(kL[5]);"},
{"lineNum":"  670","line":""},
{"lineNum":"  671","line":"            xp = xp - kn * rho * vr0*vr0*vr0 * F_yn_4(rho, ybar)","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":"  672","line":"                    + ks * rho * vr0*vr0*vr0 * F_ys_4(rho, ybar)","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  673","line":"                    ;"},
{"lineNum":"  674","line":""},
{"lineNum":"  675","line":"            yp = yp - kn * rho * vr0*vr0*vr0 * F_rn_4(rho, ybar)","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":"  676","line":"                    + ks * rho * vr0*vr0*vr0 * F_rs_4(rho, ybar)","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  677","line":"                    ;"},
{"lineNum":"  678","line":"        }"},
{"lineNum":"  679","line":""},
{"lineNum":"  680","line":"        // decapole"},
{"lineNum":"  681","line":"        if (kL[6] || kL[7])","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  682","line":"        {"},
{"lineNum":"  683","line":"            T kn(kL[6]);"},
{"lineNum":"  684","line":"            T ks(kL[7]);"},
{"lineNum":"  685","line":""},
{"lineNum":"  686","line":"            xp = xp - kn * rho * vr0*vr0*vr0*vr0 * F_yn_5(rho, ybar)","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":"  687","line":"                    + ks * rho * vr0*vr0*vr0*vr0 * F_ys_5(rho, ybar)","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  688","line":"                    ;"},
{"lineNum":"  689","line":""},
{"lineNum":"  690","line":"            yp = yp - kn * rho * vr0*vr0*vr0*vr0 * F_rn_5(rho, ybar)","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":"  691","line":"                    + ks * rho * vr0*vr0*vr0*vr0 * F_rs_5(rho, ybar)","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  692","line":"                    ;"},
{"lineNum":"  693","line":"        }"},
{"lineNum":"  694","line":"    }","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":"  695","line":""},
{"lineNum":"  696","line":""},
{"lineNum":"  697","line":""},
{"lineNum":"  698","line":"    // quadrupole with simple n kicks algorithm. non-Yoshida"},
{"lineNum":"  699","line":"    template <typename T>"},
{"lineNum":"  700","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  701","line":"    void quadrupole_chef"},
{"lineNum":"  702","line":"      (T & x, T & xp, T & y, T & yp, T & cdt, T const& dpop,"},
{"lineNum":"  703","line":"       double pref, double m, double refcdt, double len, double * str, int kicks)"},
{"lineNum":"  704","line":"    {"},
{"lineNum":"  705","line":"        double substep_ref_cdt = refcdt / kicks;"},
{"lineNum":"  706","line":"        double frontLength     = 6.0*(len/4.0)/15.0;"},
{"lineNum":"  707","line":"        double sepLength       = ( len - 2.0*frontLength ) / 3.0;"},
{"lineNum":"  708","line":"        double kl[2]           = {str[0] * len / 4.0, str[1] * len / 4.0};"},
{"lineNum":"  709","line":""},
{"lineNum":"  710","line":"        if( kicks == 1 )"},
{"lineNum":"  711","line":"        {"},
{"lineNum":"  712","line":"            kl[0] = str[0] * len;"},
{"lineNum":"  713","line":"            kl[1] = str[1] * len;"},
{"lineNum":"  714","line":""},
{"lineNum":"  715","line":"            drift_unit( x, xp, y, yp, cdt, dpop, 0.5 * len, pref, m, substep_ref_cdt );"},
{"lineNum":"  716","line":"            thin_quadrupole_unit(x, xp, y, yp, kl);  // str*len"},
{"lineNum":"  717","line":"            drift_unit( x, xp, y, yp, cdt, dpop, 0.5 * len, pref, m, substep_ref_cdt );"},
{"lineNum":"  718","line":"        }"},
{"lineNum":"  719","line":"        else if( (kicks % 4) == 0 )"},
{"lineNum":"  720","line":"        {"},
{"lineNum":"  721","line":"            int    u     = kicks/4;"},
{"lineNum":"  722","line":"            double xu    = u;"},
{"lineNum":"  723","line":"            frontLength /= xu;"},
{"lineNum":"  724","line":"            sepLength   /= xu;"},
{"lineNum":"  725","line":"            kl[0]       /= xu;"},
{"lineNum":"  726","line":"            kl[1]       /= xu;"},
{"lineNum":"  727","line":""},
{"lineNum":"  728","line":"            for( int i=0; i<u; ++i)"},
{"lineNum":"  729","line":"            {"},
{"lineNum":"  730","line":"                drift_unit( x, xp, y, yp, cdt, dpop, frontLength, pref, m, substep_ref_cdt );"},
{"lineNum":"  731","line":"                thin_quadrupole_unit(x, xp, y, yp, kl);  // quaterStrength"},
{"lineNum":"  732","line":""},
{"lineNum":"  733","line":"                for( int i=0; i<3; ++i)"},
{"lineNum":"  734","line":"                {"},
{"lineNum":"  735","line":"                    drift_unit( x, xp, y, yp, cdt, dpop, sepLength, pref, m, substep_ref_cdt );"},
{"lineNum":"  736","line":"                    thin_quadrupole_unit(x, xp, y, yp, kl);  // quaterStrength"},
{"lineNum":"  737","line":"                }"},
{"lineNum":"  738","line":""},
{"lineNum":"  739","line":"                drift_unit( x, xp, y, yp, cdt, dpop, frontLength, pref, m, substep_ref_cdt );"},
{"lineNum":"  740","line":"            }"},
{"lineNum":"  741","line":"        }"},
{"lineNum":"  742","line":"        else"},
{"lineNum":"  743","line":"        {"},
{"lineNum":"  744","line":"            kl[0] = str[0] * len / kicks;"},
{"lineNum":"  745","line":"            kl[1] = str[1] * len / kicks;"},
{"lineNum":"  746","line":""},
{"lineNum":"  747","line":"            drift_unit( x, xp, y, yp, cdt, dpop, len / (2.0*kicks), pref, m, substep_ref_cdt );"},
{"lineNum":"  748","line":"            thin_quadrupole_unit(x, xp, y, yp, kl);  // str*len/kicks"},
{"lineNum":"  749","line":""},
{"lineNum":"  750","line":"            for( int i=0; i<kicks-1; ++i )"},
{"lineNum":"  751","line":"            {"},
{"lineNum":"  752","line":"                drift_unit( x, xp, y, yp, cdt, dpop, len / kicks, pref, m, substep_ref_cdt );"},
{"lineNum":"  753","line":"                thin_quadrupole_unit(x, xp, y, yp, kl);  // str*len/kicks"},
{"lineNum":"  754","line":"            }"},
{"lineNum":"  755","line":""},
{"lineNum":"  756","line":"            drift_unit( x, xp, y, yp, cdt, dpop, len / (2.0*kicks), pref, m, substep_ref_cdt );"},
{"lineNum":"  757","line":"        }"},
{"lineNum":"  758","line":"    }"},
{"lineNum":"  759","line":""},
{"lineNum":"  760","line":"    // thin kick dipole"},
{"lineNum":"  761","line":"    template <typename T>"},
{"lineNum":"  762","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  763","line":"    void thin_dipole_unit"},
{"lineNum":"  764","line":"      (T const& x, T& xp, T const& y, T& yp, double const * kL)"},
{"lineNum":"  765","line":"    {"},
{"lineNum":"  766","line":"        xp = xp - T(kL[0]);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  767","line":"        yp = yp + T(kL[1]);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  768","line":"    }"},
{"lineNum":"  769","line":""},
{"lineNum":"  770","line":"    template <typename T>"},
{"lineNum":"  771","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  772","line":"    void thin_quadrupole_unit"},
{"lineNum":"  773","line":"      (T const& x, T& xp, T const& y, T& yp, double const * kL)"},
{"lineNum":"  774","line":"    {"},
{"lineNum":"  775","line":"        T vk0(kL[0]);","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":"  776","line":"        T vk1(kL[1]);","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":"  777","line":""},
{"lineNum":"  778","line":"        xp = xp - vk0 * x + vk1 * y;","class":"lineNoCov","hits":"0","possible_hits":"28",},
{"lineNum":"  779","line":"        yp = yp + vk0 * y + vk1 * x;","class":"lineNoCov","hits":"0","possible_hits":"28",},
{"lineNum":"  780","line":"    }"},
{"lineNum":"  781","line":""},
{"lineNum":"  782","line":"    template <typename T>"},
{"lineNum":"  783","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  784","line":"    void thin_sextupole_unit"},
{"lineNum":"  785","line":"      (T const& x, T& xp, T const& y, T& yp, double const * kL)"},
{"lineNum":"  786","line":"    {"},
{"lineNum":"  787","line":"        T vk0(kL[0]);","class":"lineNoCov","hits":"0","possible_hits":"8",},
{"lineNum":"  788","line":"        T vk1(kL[1]);","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":"  789","line":""},
{"lineNum":"  790","line":"        xp = xp - T(0.5) * vk0 * (x * x - y * y) + vk1 * x * y;","class":"lineNoCov","hits":"0","possible_hits":"29",},
{"lineNum":"  791","line":"        yp = yp + vk0 * x * y + T(0.5) * vk1 * (x * x - y * y);","class":"lineNoCov","hits":"0","possible_hits":"41",},
{"lineNum":"  792","line":"    }"},
{"lineNum":"  793","line":""},
{"lineNum":"  794","line":"    template <typename T>"},
{"lineNum":"  795","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  796","line":"    void thin_octupole_unit"},
{"lineNum":"  797","line":"      (T const& x, T& xp, T const& y, T& yp, double const * kL)"},
{"lineNum":"  798","line":"    {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  799","line":"        T vk0(kL[0]);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  800","line":"        T vk1(kL[1]);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  801","line":""},
{"lineNum":"  802","line":"        T n1(0.5);"},
{"lineNum":"  803","line":"        T n2(1.0/3.0);"},
{"lineNum":"  804","line":""},
{"lineNum":"  805","line":"        xp = xp - n1 * vk0 * (x * x * x * n2 - x * y * y)","class":"lineNoCov","hits":"0","possible_hits":"23",},
{"lineNum":"  806","line":"                + n1 * vk1 * (x * x * y - y * y * y * n2);","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":"  807","line":"        yp = yp - n1 * vk0 * (y * y * y * n2 - x * x * y)","class":"lineNoCov","hits":"0","possible_hits":"24",},
{"lineNum":"  808","line":"                + n1 * vk1 * (x * x * x * n2 - x * y * y);","class":"lineNoCov","hits":"0","possible_hits":"8",},
{"lineNum":"  809","line":"    }","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  810","line":""},
{"lineNum":"  811","line":"    template <typename T>"},
{"lineNum":"  812","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  813","line":"    void thin_rbend_unit"},
{"lineNum":"  814","line":"      (T const& x, T& xp, T const& y, T& yp, double const * kL)"},
{"lineNum":"  815","line":"    {"},
{"lineNum":"  816","line":"        thin_dipole_unit(x, xp, y, yp, kL);"},
{"lineNum":"  817","line":"        thin_quadrupole_unit(x, xp, y, yp, kL + 2);"},
{"lineNum":"  818","line":"        thin_sextupole_unit(x, xp, y, yp, 0.0, kL + 4);"},
{"lineNum":"  819","line":"    }"},
{"lineNum":"  820","line":""},
{"lineNum":"  821","line":"    template <typename T>"},
{"lineNum":"  822","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  823","line":"    void rbend_thin_cf_kick"},
{"lineNum":"  824","line":"      (T const& x, T& xp, T const& y, T& yp, double r0, double const * kL)"},
{"lineNum":"  825","line":"    {"},
{"lineNum":"  826","line":"        thin_quadrupole_unit(x, xp, y, yp, kL + 0);"},
{"lineNum":"  827","line":"        thin_sextupole_unit(x, xp, y, yp, 0.0, kL + 2);"},
{"lineNum":"  828","line":"    }"},
{"lineNum":"  829","line":""},
{"lineNum":"  830","line":"    template <typename T>"},
{"lineNum":"  831","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  832","line":"    void thin_kicker_unit"},
{"lineNum":"  833","line":"      (T & p, double kL)"},
{"lineNum":"  834","line":"    {"},
{"lineNum":"  835","line":"        p = p + T(kL);"},
{"lineNum":"  836","line":"    }"},
{"lineNum":"  837","line":""},
{"lineNum":"  838","line":"    template <typename T>"},
{"lineNum":"  839","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  840","line":"    void thin_kicker_unit"},
{"lineNum":"  841","line":"      (T& xp, T& yp, double const * kL)"},
{"lineNum":"  842","line":"    {"},
{"lineNum":"  843","line":"        xp = xp + T(kL[0]);","class":"lineNoCov","hits":"0","possible_hits":"20",},
{"lineNum":"  844","line":"        yp = yp + T(kL[1]);","class":"lineNoCov","hits":"0","possible_hits":"19",},
{"lineNum":"  845","line":"    }"},
{"lineNum":"  846","line":""},
{"lineNum":"  847","line":"    template <typename T>"},
{"lineNum":"  848","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  849","line":"    void constfoc_unit"},
{"lineNum":"  850","line":"      (T & x, T & xp, double cs, double sn, double beta, double ibeta)"},
{"lineNum":"  851","line":"    {"},
{"lineNum":"  852","line":"        T vcs(cs), vsn(sn), vbeta(beta), vibeta(ibeta);"},
{"lineNum":"  853","line":""},
{"lineNum":"  854","line":"        T x1  = x * vcs + xp * vbeta * vsn;"},
{"lineNum":"  855","line":"        T xp1 = - x * vsn * vibeta + xp * vcs;"},
{"lineNum":"  856","line":""},
{"lineNum":"  857","line":"        x = x1;"},
{"lineNum":"  858","line":"        xp = xp1;"},
{"lineNum":"  859","line":"    }"},
{"lineNum":"  860","line":""},
{"lineNum":"  861","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  862","line":"    double thin_rfcavity_pnew"},
{"lineNum":"  863","line":"      (double pref, double m, double volt, double phi_s)"},
{"lineNum":"  864","line":"    {"},
{"lineNum":"  865","line":"        double E0 = sqrt(pref * pref + m * m);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  866","line":"        double E1 = E0 + volt * sin(phi_s);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  867","line":"        return sqrt(E1 * E1 - m * m);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  868","line":"    }"},
{"lineNum":"  869","line":""},
{"lineNum":"  870","line":"    template <typename T>"},
{"lineNum":"  871","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  872","line":"    void thin_rfcavity_unit"},
{"lineNum":"  873","line":"      (T & px, T & py, T const & cdt, T & dpop,"},
{"lineNum":"  874","line":"       double w_rf, double volt, double phi_s, double m,"},
{"lineNum":"  875","line":"       double old_ref_p, double new_ref_p, double const * mhp, int nh)"},
{"lineNum":"  876","line":"    {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  877","line":"        // 0 strength RF cavity does nothing (fast)"},
{"lineNum":"  878","line":"        if (volt == 0.0) {","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  879","line":"            return;"},
{"lineNum":"  880","line":"        }"},
{"lineNum":"  881","line":"        double const anh_phase             = 0.0;"},
{"lineNum":"  882","line":"        double       mhp_harmonic_multiple = 1.0;"},
{"lineNum":"  883","line":"        double       mhp_relative_strength = 1.0;"},
{"lineNum":"  884","line":"        double       mhp_phase_shift       = 0.0;"},
{"lineNum":"  885","line":""},
{"lineNum":"  886","line":"        T phase_slip_argument = ( cdt * T(w_rf / pconstants::c) ) + T(anh_phase);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  887","line":""},
{"lineNum":"  888","line":"        T strength_factor(0.0);"},
{"lineNum":"  889","line":""},
{"lineNum":"  890","line":"        for (int i=0; i<nh; ++i)","class":"lineNoCov","hits":"0","possible_hits":"9",},
{"lineNum":"  891","line":"        {"},
{"lineNum":"  892","line":"            mhp_harmonic_multiple = mhp[i*3  ];","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  893","line":"            mhp_relative_strength = mhp[i*3+1];","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":"  894","line":"            mhp_phase_shift       = mhp[i*3+2];","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  895","line":""},
{"lineNum":"  896","line":"            strength_factor = strength_factor + T(mhp_relative_strength) *","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":"  897","line":"                sin( T(mhp_harmonic_multiple) *","class":"lineNoCov","hits":"0","possible_hits":"14",},
{"lineNum":"  898","line":"                        (T(phi_s) + phase_slip_argument) + T(mhp_phase_shift) );","class":"lineNoCov","hits":"0","possible_hits":"8",},
{"lineNum":"  899","line":"        }"},
{"lineNum":"  900","line":""},
{"lineNum":"  901","line":"        T p = T(old_ref_p) * (dpop + T(1.0));","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  902","line":"        T E = sqrt(p * p + T(m * m));","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  903","line":""},
{"lineNum":"  904","line":"        E = E + T(volt) * strength_factor;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  905","line":""},
{"lineNum":"  906","line":"        px = px * T(old_ref_p / new_ref_p);","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":"  907","line":"        py = py * T(old_ref_p / new_ref_p);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  908","line":""},
{"lineNum":"  909","line":"        dpop = sqrt((E-T(m))*(E+T(m))) / T(new_ref_p) - T(1.0);","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":"  910","line":"    }","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":"  911","line":""},
{"lineNum":"  912","line":""},
{"lineNum":"  913","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  914","line":"    double factorial(int n)"},
{"lineNum":"  915","line":"    {"},
{"lineNum":"  916","line":"        if (n == 0) return 1.0;","class":"lineNoCov","hits":"0","possible_hits":"48",},
{"lineNum":"  917","line":""},
{"lineNum":"  918","line":"        double r = 1;"},
{"lineNum":"  919","line":"        for(int i = 1; i <= n; ++i) r *= i;","class":"lineNoCov","hits":"0","possible_hits":"50",},
{"lineNum":"  920","line":"        return r;"},
{"lineNum":"  921","line":"    }"},
{"lineNum":"  922","line":""},
{"lineNum":"  923","line":"    // general thin magnets of n-th order"},
{"lineNum":"  924","line":"    // n = 1, dipole; n = 2, quadrupole; n = 3, sextupole, etc."},
{"lineNum":"  925","line":"    template <typename T>"},
{"lineNum":"  926","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  927","line":"    void thin_magnet_unit"},
{"lineNum":"  928","line":"      (T const& x, T& xp, T const& y, T& yp, double const * kL, int n)"},
{"lineNum":"  929","line":"    {","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  930","line":"        for(int k = 0; k < n; k += 4)","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":"  931","line":"        {"},
{"lineNum":"  932","line":"            xp = xp - T(kL[0] * (n-k)) * qpow(x, n-k-1) * qpow(y, k)","class":"lineNoCov","hits":"0","possible_hits":"11",},
{"lineNum":"  933","line":"                         / T(factorial(n-k) * factorial(k));","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  934","line":"        }"},
{"lineNum":"  935","line":""},
{"lineNum":"  936","line":"        for(int k = 2; k < n; k += 4)","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":"  937","line":"        {"},
{"lineNum":"  938","line":"            xp = xp + T(kL[0] * (n-k)) * qpow(x, n-k-1) * qpow(y, k)","class":"lineNoCov","hits":"0","possible_hits":"13",},
{"lineNum":"  939","line":"                         / T(factorial(n-k) * factorial(k));","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  940","line":"        }"},
{"lineNum":"  941","line":""},
{"lineNum":"  942","line":"        for(int k = 1; k < n; k += 4)","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":"  943","line":"        {"},
{"lineNum":"  944","line":"            xp = xp + T(kL[1] * (n-k)) * qpow(x, n-k-1) * qpow(y, k)","class":"lineNoCov","hits":"0","possible_hits":"13",},
{"lineNum":"  945","line":"                         / T(factorial(n-k) * factorial(k));","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  946","line":"        }"},
{"lineNum":"  947","line":""},
{"lineNum":"  948","line":"        for(int k = 3; k < n; k += 4)","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":"  949","line":"        {"},
{"lineNum":"  950","line":"            xp = xp - T(kL[1] * (n-k)) * qpow(x, n-k-1) * qpow(y, k)","class":"lineNoCov","hits":"0","possible_hits":"13",},
{"lineNum":"  951","line":"                         / T(factorial(n-k) * factorial(k));","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  952","line":"        }"},
{"lineNum":"  953","line":""},
{"lineNum":"  954","line":"        for(int k = 4; k <= n; k += 4)","class":"lineNoCov","hits":"0","possible_hits":"8",},
{"lineNum":"  955","line":"        {"},
{"lineNum":"  956","line":"            yp = yp - T(kL[0] * k) * qpow(x, n-k) * qpow(y, k-1)","class":"lineNoCov","hits":"0","possible_hits":"13",},
{"lineNum":"  957","line":"                         / T(factorial(n-k) * factorial(k));","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  958","line":"        }"},
{"lineNum":"  959","line":""},
{"lineNum":"  960","line":"        for(int k = 2; k <= n; k += 4)","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":"  961","line":"        {"},
{"lineNum":"  962","line":"            yp = yp + T(kL[0] * k) * qpow(x, n-k) * qpow(y, k-1)","class":"lineNoCov","hits":"0","possible_hits":"13",},
{"lineNum":"  963","line":"                         / T(factorial(n-k) * factorial(k));","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  964","line":"        }"},
{"lineNum":"  965","line":""},
{"lineNum":"  966","line":"        for(int k = 1; k <= n; k += 4)","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":"  967","line":"        {"},
{"lineNum":"  968","line":"            yp = yp + T(kL[1] * k) * qpow(x, n-k) * qpow(y, k-1)","class":"lineNoCov","hits":"0","possible_hits":"11",},
{"lineNum":"  969","line":"                         / T(factorial(n-k) * factorial(k));","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  970","line":"        }"},
{"lineNum":"  971","line":""},
{"lineNum":"  972","line":"        for(int k = 3; k <= n; k += 4)","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":"  973","line":"        {"},
{"lineNum":"  974","line":"            yp = yp - T(kL[1] * k) * qpow(x, n-k) * qpow(y, k-1)","class":"lineNoCov","hits":"0","possible_hits":"13",},
{"lineNum":"  975","line":"                         / T(factorial(n-k) * factorial(k));","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  976","line":"        }"},
{"lineNum":"  977","line":"    }","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":"  978","line":""},
{"lineNum":"  979","line":"#if 0"},
{"lineNum":"  980","line":"    // combined thin multipole kicks of n-th order"},
{"lineNum":"  981","line":"    // n = 1, dipole; n = 2, quadrupole; n = 3, sextupole, etc."},
{"lineNum":"  982","line":"    template <typename T>"},
{"lineNum":"  983","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  984","line":"    void thin_multipole_kick"},
{"lineNum":"  985","line":"      (T const& x, T& xp, T const& y, T& yp, double const * kL, int n)"},
{"lineNum":"  986","line":"#endif"},
{"lineNum":"  987","line":""},
{"lineNum":"  988","line":"    template<class T>"},
{"lineNum":"  989","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":"  990","line":"    void nllens_unit"},
{"lineNum":"  991","line":"        (T const& x, T& xp, T const& y, T& yp, T const&, double const* k)"},
{"lineNum":"  992","line":"    {","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  993","line":"        const T icnll = T(k[0]);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  994","line":"        const T kick = T(k[1]);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  995","line":""},
{"lineNum":"  996","line":"        T xbar = x * icnll;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  997","line":"        T ybar = y * icnll;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  998","line":""},
{"lineNum":"  999","line":"        if (ybar == 0 && (xbar >= 1.0 || xbar <= -1.0))","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1000","line":"        {"},
{"lineNum":" 1001","line":"            xp = quiet_nan();","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1002","line":"            yp = quiet_nan();","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":" 1003","line":"            return;"},
{"lineNum":" 1004","line":"        }"},
{"lineNum":" 1005","line":""},
{"lineNum":" 1006","line":"#if 0"},
{"lineNum":" 1007","line":"        Kokkos::complex<double> c_i(0.0, 1.0);"},
{"lineNum":" 1008","line":"        Kokkos::complex<double> c_1(1.0, 0.0);"},
{"lineNum":" 1009","line":""},
{"lineNum":" 1010","line":"        Kokkos::complex<double> zeta(xbar, ybar);"},
{"lineNum":" 1011","line":"        Kokkos::complex<double> croot = sqrt(c_1 - zeta*zeta);"},
{"lineNum":" 1012","line":""},
{"lineNum":" 1013","line":"        // Kokkos::complex doesnt provide the log() method, so we"},
{"lineNum":" 1014","line":"        // need to calculate the following manually:"},
{"lineNum":" 1015","line":"        // Kokkos::complex<double> carcsin = -c_i * log(c_i * zeta + croot);"},
{"lineNum":" 1016","line":""},
{"lineNum":" 1017","line":"        // convert co to polar form"},
{"lineNum":" 1018","line":"        Kokkos::complex<double> co = c_i * zeta + croot;"},
{"lineNum":" 1019","line":"        double a = co.real();"},
{"lineNum":" 1020","line":"        double b = co.imag();"},
{"lineNum":" 1021","line":"        double r = sqrt(a*a + b*b);"},
{"lineNum":" 1022","line":"        double theta = (a>0) ? atan(b/a) : atan(b/a) + mconstants::pi;"},
{"lineNum":" 1023","line":"        Kokkos::complex<double> logco(log(r), theta);"},
{"lineNum":" 1024","line":"        Kokkos::complex<double> carcsin = -c_i * logco;"},
{"lineNum":" 1025","line":""},
{"lineNum":" 1026","line":"        // keep working on the rest"},
{"lineNum":" 1027","line":"        Kokkos::complex<double> dF = zeta/(croot*croot) + carcsin/(croot*croot*croot);"},
{"lineNum":" 1028","line":""},
{"lineNum":" 1029","line":"        T dpx = kick * dF.real();"},
{"lineNum":" 1030","line":"        T dpy = -kick * dF.imag();"},
{"lineNum":" 1031","line":""},
{"lineNum":" 1032","line":"        xp = xp + dpx;"},
{"lineNum":" 1033","line":"        yp = yp + dpy;"},
{"lineNum":" 1034","line":"#endif"},
{"lineNum":" 1035","line":""},
{"lineNum":" 1036","line":"        T zeta_r = xbar;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1037","line":"        T zeta_i = ybar;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1038","line":""},
{"lineNum":" 1039","line":"        // c = c_1 - zeta*zeta"},
{"lineNum":" 1040","line":"        T c_r =  T(1.0) - zeta_r * zeta_r + zeta_i * zeta_i;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":" 1041","line":"        T c_i = -T(2.0) * zeta_r * zeta_i;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":" 1042","line":""},
{"lineNum":" 1043","line":"        // croot = sqrt(c);"},
{"lineNum":" 1044","line":"        T croot_r = sqrt(T(0.5) * ( c_r + sqrt(c_r*c_r + c_i*c_i)));","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1045","line":"        T croot_i = sqrt(T(0.5) * (-c_r + sqrt(c_r*c_r + c_i*c_i)));","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":" 1046","line":""},
{"lineNum":" 1047","line":"        // co = c_i * zeta + croot"},
{"lineNum":" 1048","line":"        T co_r = croot_r - zeta_i;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1049","line":"        T co_i = croot_i + zeta_r;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1050","line":""},
{"lineNum":" 1051","line":"        T r = sqrt(co_r*co_r + co_i*co_i);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":" 1052","line":""},
{"lineNum":" 1053","line":"        T theta = (co_r>0)","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1054","line":"            ? atan(co_i/co_r) + T(0.0)","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":" 1055","line":"            : atan(co_i/co_r) + T(mconstants::pi);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1056","line":""},
{"lineNum":" 1057","line":"        // log(co)"},
{"lineNum":" 1058","line":"        T logco_r = log(r);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1059","line":"        T logco_i = theta;"},
{"lineNum":" 1060","line":""},
{"lineNum":" 1061","line":"        // carcsin = -c_i * log(co)"},
{"lineNum":" 1062","line":"        T carcsin_r = logco_i;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1063","line":"        T carcsin_i = -logco_r;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1064","line":""},
{"lineNum":" 1065","line":"        // cr2 = croot * croot"},
{"lineNum":" 1066","line":"        T cr2_r = croot_r * croot_r - croot_i * croot_i;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":" 1067","line":"        T cr2_i = T(2.0) * croot_r * croot_i;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1068","line":""},
{"lineNum":" 1069","line":"        // df1 = zeta/cr2"},
{"lineNum":" 1070","line":"        T df1_r = (cr2_r*zeta_r+cr2_i*zeta_i) / (cr2_r*cr2_r+cr2_i*cr2_i);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":" 1071","line":"        T df1_i = (cr2_r*zeta_i-cr2_i*zeta_r) / (cr2_r*cr2_r+cr2_i*cr2_i);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":" 1072","line":""},
{"lineNum":" 1073","line":"        // df2 = carcsin/cr2"},
{"lineNum":" 1074","line":"        T df2_r = (cr2_r*carcsin_r+cr2_i*carcsin_i) / (cr2_r*cr2_r+cr2_i*cr2_i);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":" 1075","line":"        T df2_i = (cr2_r*carcsin_i-cr2_i*carcsin_r) / (cr2_r*cr2_r+cr2_i*cr2_i);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1076","line":""},
{"lineNum":" 1077","line":"        // df = df1 + df2"},
{"lineNum":" 1078","line":"        T df_r = df1_r + df2_r;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1079","line":"        T df_i = df1_i + df2_i;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1080","line":""},
{"lineNum":" 1081","line":"        T dpx =  kick * df_r;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1082","line":"        T dpy = -kick * df_i;"},
{"lineNum":" 1083","line":""},
{"lineNum":" 1084","line":"        xp = xp + dpx;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1085","line":"        yp = yp + dpy;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1086","line":"    }","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":" 1087","line":""},
{"lineNum":" 1088","line":"    template <typename T>"},
{"lineNum":" 1089","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1090","line":"    void dipedge_unit"},
{"lineNum":" 1091","line":"        (T & x, T & xp, T & y, T & yp, double re_2_1, double re_4_3, double const * te)"},
{"lineNum":" 1092","line":"    {"},
{"lineNum":" 1093","line":"        // linear terms"},
{"lineNum":" 1094","line":"        xp = xp + T(re_2_1) * x;"},
{"lineNum":" 1095","line":"        yp = yp + T(re_4_3) * y;"},
{"lineNum":" 1096","line":""},
{"lineNum":" 1097","line":"        // quadratic terms"},
{"lineNum":" 1098","line":"        x  = x  + T(te[0]) * x*x + T(te[1]) * y*y;"},
{"lineNum":" 1099","line":"        xp = xp + T(te[2]) * x*x + T(te[4]) * y*y + T(te[3]) * x*xp*T(2) + T(te[5]) * y*yp*T(2);"},
{"lineNum":" 1100","line":"        y  = y  + T(te[6]) * x*y*T(2);"},
{"lineNum":" 1101","line":"        yp = yp + T(te[7]) * x*y*T(2) + T(te[8]) * x*yp*T(2) + T(te[9]) * y*xp*T(2);"},
{"lineNum":" 1102","line":"    }"},
{"lineNum":" 1103","line":""},
{"lineNum":" 1104","line":""},
{"lineNum":" 1105","line":"    template<class T>"},
{"lineNum":" 1106","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1107","line":"    void solenoid_unit"},
{"lineNum":" 1108","line":"        (T& x, T& xp, T& y, T& yp, T& cdt, T const& dpop,"},
{"lineNum":" 1109","line":"         double ks, double ksl, double length, double ref_p, double mass, double ref_cdt)"},
{"lineNum":" 1110","line":"    {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":" 1111","line":"        T uni(1.0);"},
{"lineNum":" 1112","line":""},
{"lineNum":" 1113","line":"        T p2 = (uni + dpop) * (uni + dpop);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":" 1114","line":"        T zp = sqrt(p2 - xp*xp - yp*yp);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":" 1115","line":"        T dtheta = T(ksl) / zp;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1116","line":""},
{"lineNum":" 1117","line":"        T sn = sin(dtheta);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1118","line":"        T cs = cos(dtheta);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1119","line":""},
{"lineNum":" 1120","line":"        T xpi = xp;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1121","line":"        T ypi = yp;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1122","line":""},
{"lineNum":" 1123","line":"        xp =    cs*xpi + sn*ypi;","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1124","line":"        yp = (-sn)*xpi + cs*ypi;","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1125","line":""},
{"lineNum":" 1126","line":"        cs = cs - uni;","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":" 1127","line":""},
{"lineNum":" 1128","line":"        x = x + (    cs * (-ypi) + sn * xpi ) / T(ks);","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1129","line":"        y = y + ( (-sn) * (-ypi) + cs * xpi ) / T(ks);","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1130","line":""},
{"lineNum":" 1131","line":"        T en = sqrt(p2 * T(ref_p) * T(ref_p) + T(mass) * T(mass));","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1132","line":"        T duration = T(length) / (zp * T(ref_p) / en );","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1133","line":""},
{"lineNum":" 1134","line":"        cdt = cdt + duration - T(ref_cdt);","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1135","line":"    }","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1136","line":""},
{"lineNum":" 1137","line":"    template<class T>"},
{"lineNum":" 1138","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1139","line":"    void solenoid_in_edge_kick"},
{"lineNum":" 1140","line":"        (T const & x, T& xp, T const & y, T& yp, double kse)"},
{"lineNum":" 1141","line":"    {"},
{"lineNum":" 1142","line":"        xp = xp + T(kse) * y;"},
{"lineNum":" 1143","line":"        yp = yp - T(kse) * x;"},
{"lineNum":" 1144","line":"    }"},
{"lineNum":" 1145","line":""},
{"lineNum":" 1146","line":"    template<class T>"},
{"lineNum":" 1147","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1148","line":"    void solenoid_out_edge_kick"},
{"lineNum":" 1149","line":"        (T const & x, T& xp, T const & y, T& yp, double kse)"},
{"lineNum":" 1150","line":"    {"},
{"lineNum":" 1151","line":"        xp = xp - T(kse) * y;"},
{"lineNum":" 1152","line":"        yp = yp + T(kse) * x;"},
{"lineNum":" 1153","line":"    }"},
{"lineNum":" 1154","line":""},
{"lineNum":" 1155","line":"    // k[6]:"},
{"lineNum":" 1156","line":"    // k[0] = beta_b, k[1] = gamma_b, k[2] = beta_e,"},
{"lineNum":" 1157","line":"    // k[3] = ioe,    k[4] = l,       k[5] = radius"},
{"lineNum":" 1158","line":"    template<class T>"},
{"lineNum":" 1159","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1160","line":"    void elens_kick_gaussian"},
{"lineNum":" 1161","line":"        (T const& x, T& xp, T const& y, T& yp, T const& dpop, double const* k)"},
{"lineNum":" 1162","line":"    {","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":" 1163","line":"        const double small_radius(1.0e-10);"},
{"lineNum":" 1164","line":"        T r = sqrt( x * x + y * y );","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1165","line":""},
{"lineNum":" 1166","line":"        // no kick at r = 0.0"},
{"lineNum":" 1167","line":"        if (r == 0.0) return;","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":" 1168","line":""},
{"lineNum":" 1169","line":"        const T t1(1.0);"},
{"lineNum":" 1170","line":"        const T t2(2.0);"},
{"lineNum":" 1171","line":"        const T t4(4.0);"},
{"lineNum":" 1172","line":"        const T t6(6.0);"},
{"lineNum":" 1173","line":"        const T t8(8.0);"},
{"lineNum":" 1174","line":""},
{"lineNum":" 1175","line":"        const T beta_b  = k[0];","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1176","line":"        const T gamma_b = k[1];","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1177","line":"        const T beta_e  = k[2];","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1178","line":"        const T ioe     = k[3];","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1179","line":"        const T l       = k[4];","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1180","line":"        const T radius  = k[5];","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1181","line":""},
{"lineNum":" 1182","line":"        T betagamma_p = (t1 + dpop) * beta_b * gamma_b;","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1183","line":"        T beta_p = betagamma_p / sqrt(t1 + betagamma_p * betagamma_p);","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":" 1184","line":""},
{"lineNum":" 1185","line":"        T factors = -t2 * ioe * l * T(pconstants::rp) *","class":"lineNoCov","hits":"0","possible_hits":"9",},
{"lineNum":" 1186","line":"            (t1 + beta_e * beta_p) / (beta_e * beta_p * beta_b * gamma_b * T(pconstants::c));","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":" 1187","line":""},
{"lineNum":" 1188","line":"        T kick(0.0);"},
{"lineNum":" 1189","line":""},
{"lineNum":" 1190","line":"        if (r < small_radius)","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1191","line":"        {"},
{"lineNum":" 1192","line":"            kick = factors * ( r / (t2 * radius * radius) -","class":"lineNoCov","hits":"0","possible_hits":"8",},
{"lineNum":" 1193","line":"                    (t1 / t2) * ((r*r*r) / (t4*radius*radius*radius*radius)) +","class":"lineNoCov","hits":"0","possible_hits":"10",},
{"lineNum":" 1194","line":"                    (t1 / t6) * ((r*r*r*r*r) / (t8*radius*radius*radius*radius*radius*radius)) );","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":" 1195","line":"        }"},
{"lineNum":" 1196","line":"        else"},
{"lineNum":" 1197","line":"        {"},
{"lineNum":" 1198","line":"            kick = factors * (t1 - exp( - r * r / (t2 * radius * radius))) / r;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1199","line":"        }"},
{"lineNum":" 1200","line":""},
{"lineNum":" 1201","line":"        xp = xp + kick * x / r;","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1202","line":"        yp = yp + kick * y / r;","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":" 1203","line":"    }","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1204","line":""},
{"lineNum":" 1205","line":"    template<class T>"},
{"lineNum":" 1206","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1207","line":"    void elens_kick_uniform"},
{"lineNum":" 1208","line":"        (T const& x, T& xp, T const& y, T& yp, T const& dpop, double const* k)"},
{"lineNum":" 1209","line":"    {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1210","line":"        //const double small_radius = 1.0e-10;"},
{"lineNum":" 1211","line":"        T r = sqrt( x * x + y * y );","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1212","line":""},
{"lineNum":" 1213","line":"        // no kick at r = 0.0"},
{"lineNum":" 1214","line":"        if (r == 0.0) return;","class":"lineNoCov","hits":"0","possible_hits":"9",},
{"lineNum":" 1215","line":""},
{"lineNum":" 1216","line":"        const T beta_b  = k[0];","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":" 1217","line":"        const T gamma_b = k[1];","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":" 1218","line":"        const T beta_e  = k[2];","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":" 1219","line":"        const T ioe     = k[3];","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1220","line":"        const T l       = k[4];","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":" 1221","line":"        const T radius  = k[5];","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":" 1222","line":""},
{"lineNum":" 1223","line":"        T betagamma_p = (T(1.0) + dpop) * beta_b * gamma_b;","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1224","line":"        T beta_p = betagamma_p / sqrt(T(1.0) + betagamma_p * betagamma_p);","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1225","line":""},
{"lineNum":" 1226","line":"        T factors = -T(2.0) * ioe * l * T(pconstants::rp) *","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1227","line":"            (T(1.0) + beta_e * beta_p) /","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":" 1228","line":"            (beta_e * beta_p * beta_b * gamma_b * T(pconstants::c));","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1229","line":""},
{"lineNum":" 1230","line":"        T kick = factors * r / (radius * radius);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":" 1231","line":""},
{"lineNum":" 1232","line":"        xp = xp + kick * x / r;","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1233","line":"        yp = yp + kick * y / r;","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1234","line":"    }","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":" 1235","line":""},
{"lineNum":" 1236","line":""},
{"lineNum":" 1237","line":""},
{"lineNum":" 1238","line":""},
{"lineNum":" 1239","line":"    // utility"},
{"lineNum":" 1240","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1241","line":"    int full_drifts_per_step(int order)"},
{"lineNum":" 1242","line":"    { return std::pow(3.0, (order-2.0)/2.0) * 2; }"},
{"lineNum":" 1243","line":""},
{"lineNum":" 1244","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1245","line":"    int compact_drifts_per_step(int order)"},
{"lineNum":" 1246","line":"    { return (full_drifts_per_step(order) - 2) / 2 + 2; }"},
{"lineNum":" 1247","line":""},
{"lineNum":" 1248","line":"    // general n-th order yoshida"},
{"lineNum":" 1249","line":"    template<class T>"},
{"lineNum":" 1250","line":"    using yoshida_kf_t = void(*)("},
{"lineNum":" 1251","line":"            T const&, T&, T const&, T&, T const&, double const*);"},
{"lineNum":" 1252","line":""},
{"lineNum":" 1253","line":"    template<class T>"},
{"lineNum":" 1254","line":"    using bend_yoshida_kf_t = void(*)("},
{"lineNum":" 1255","line":"            T const&, T&, T const&, T&, double, double const*);"},
{"lineNum":" 1256","line":""},
{"lineNum":" 1257","line":"    template <"},
{"lineNum":" 1258","line":"        typename T,"},
{"lineNum":" 1259","line":"        yoshida_kf_t<T> kf,"},
{"lineNum":" 1260","line":"        int n,"},
{"lineNum":" 1261","line":"        int components >"},
{"lineNum":" 1262","line":"    struct yoshida_element"},
{"lineNum":" 1263","line":"    {"},
{"lineNum":" 1264","line":"        KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1265","line":"        static void integral ( T & x, T & xp,"},
{"lineNum":" 1266","line":"                               T & y, T & yp,"},
{"lineNum":" 1267","line":"                               T & cdt, T const & dpop,"},
{"lineNum":" 1268","line":"                               double pref, double m, double step_ref_cdt,"},
{"lineNum":" 1269","line":"                               double step_length, double const* step_strength,"},
{"lineNum":" 1270","line":"                               int steps, double c )"},
{"lineNum":" 1271","line":"        {","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1272","line":"            double substep_ref_cdt = step_ref_cdt / 3.0;","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1273","line":""},
{"lineNum":" 1274","line":"            yoshida_element<T, kf, n-1, components>::integral(","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":" 1275","line":"                    x, xp, y, yp, cdt, dpop, pref, m, substep_ref_cdt,"},
{"lineNum":" 1276","line":"                    step_length, step_strength, steps, c * x1(n) );","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1277","line":""},
{"lineNum":" 1278","line":"            yoshida_element<T, kf, n-1, components>::integral(","class":"lineNoCov","hits":"0","possible_hits":"7",},
{"lineNum":" 1279","line":"                    x, xp, y, yp, cdt, dpop, pref, m, substep_ref_cdt,"},
{"lineNum":" 1280","line":"                    step_length, step_strength, steps, c * x0(n) );","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1281","line":""},
{"lineNum":" 1282","line":"            yoshida_element<T, kf, n-1, components>::integral(","class":"lineNoCov","hits":"0","possible_hits":"8",},
{"lineNum":" 1283","line":"                    x, xp, y, yp, cdt, dpop, pref, m, substep_ref_cdt,"},
{"lineNum":" 1284","line":"                    step_length, step_strength, steps, c * x1(n) );"},
{"lineNum":" 1285","line":"        }","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1286","line":""},
{"lineNum":" 1287","line":"        KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1288","line":"        static double x1(int nn)"},
{"lineNum":" 1289","line":"        { return 1.0 / (2.0 - std::pow(2.0, 1.0/(2*nn+1))); }"},
{"lineNum":" 1290","line":""},
{"lineNum":" 1291","line":"        KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1292","line":"        static double x0(int nn)"},
{"lineNum":" 1293","line":"        { return 1.0 - 2.0 * x1(nn); }"},
{"lineNum":" 1294","line":"    };"},
{"lineNum":" 1295","line":""},
{"lineNum":" 1296","line":"#if 1"},
{"lineNum":" 1297","line":"    template <"},
{"lineNum":" 1298","line":"        typename T,"},
{"lineNum":" 1299","line":"        yoshida_kf_t<T> kf,"},
{"lineNum":" 1300","line":"        int components >"},
{"lineNum":" 1301","line":"    struct yoshida_element < T, kf, 0, components >"},
{"lineNum":" 1302","line":"    {"},
{"lineNum":" 1303","line":"        KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1304","line":"        static void integral ( T & x, T & xp,"},
{"lineNum":" 1305","line":"                               T & y, T & yp,"},
{"lineNum":" 1306","line":"                               T & cdt, T const & dpop,"},
{"lineNum":" 1307","line":"                               double pref, double m, double step_ref_cdt,"},
{"lineNum":" 1308","line":"                               double step_length, double const* step_strength,"},
{"lineNum":" 1309","line":"                               int steps, double c )"},
{"lineNum":" 1310","line":"        {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1311","line":"            double substep_ref_cdt = step_ref_cdt / 2.0;"},
{"lineNum":" 1312","line":"            double kl[components * 2];"},
{"lineNum":" 1313","line":""},
{"lineNum":" 1314","line":"            for (int i = 0; i < components * 2; ++i)"},
{"lineNum":" 1315","line":"                kl[i] = step_strength[i] * c;","class":"lineNoCov","hits":"0","possible_hits":"9",},
{"lineNum":" 1316","line":""},
{"lineNum":" 1317","line":"            drift_unit( x, xp, y, yp, cdt, dpop,"},
{"lineNum":" 1318","line":"                    0.5 * c * step_length, pref, m, substep_ref_cdt );","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1319","line":""},
{"lineNum":" 1320","line":"            kf( x, xp, y, yp, cdt, kl );"},
{"lineNum":" 1321","line":""},
{"lineNum":" 1322","line":"            drift_unit( x, xp, y, yp, cdt, dpop,"},
{"lineNum":" 1323","line":"                    0.5 * c * step_length, pref, m, substep_ref_cdt );"},
{"lineNum":" 1324","line":"        }","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":" 1325","line":"    };"},
{"lineNum":" 1326","line":""},
{"lineNum":" 1327","line":"#else"},
{"lineNum":" 1328","line":""},
{"lineNum":" 1329","line":"    template <"},
{"lineNum":" 1330","line":"        typename T,"},
{"lineNum":" 1331","line":"        yoshida_kf_t<T> kf,"},
{"lineNum":" 1332","line":"        int components >"},
{"lineNum":" 1333","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1334","line":"    struct yoshida_element < T, kf, 0, components >"},
{"lineNum":" 1335","line":"    {"},
{"lineNum":" 1336","line":"        KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1337","line":"        static void integral ( T & x, T & xp,"},
{"lineNum":" 1338","line":"                               T & y, T & yp,"},
{"lineNum":" 1339","line":"                               T & cdt, T const & dpop,"},
{"lineNum":" 1340","line":"                               double pref, double m, double step_ref_cdt,"},
{"lineNum":" 1341","line":"                               double step_length, double * step_strength,"},
{"lineNum":" 1342","line":"                               int steps, double c )"},
{"lineNum":" 1343","line":"        {"},
{"lineNum":" 1344","line":"            double substep_ref_cdt = step_ref_cdt;"},
{"lineNum":" 1345","line":"            double kl[components * 2];"},
{"lineNum":" 1346","line":""},
{"lineNum":" 1347","line":"            for (int i = 0; i < components * 2; ++i)"},
{"lineNum":" 1348","line":"                kl[i] = step_strength[i] * c * 0.5;"},
{"lineNum":" 1349","line":""},
{"lineNum":" 1350","line":"            kf( x, xp, y, yp, kl );"},
{"lineNum":" 1351","line":""},
{"lineNum":" 1352","line":"            drift_unit( x, xp, y, yp, cdt, dpop, c * step_length, pref, m, substep_ref_cdt );"},
{"lineNum":" 1353","line":""},
{"lineNum":" 1354","line":"            kf( x, xp, y, yp, kl );"},
{"lineNum":" 1355","line":"        }"},
{"lineNum":" 1356","line":"    };"},
{"lineNum":" 1357","line":"#endif"},
{"lineNum":" 1358","line":""},
{"lineNum":" 1359","line":""},
{"lineNum":" 1360","line":"    template <"},
{"lineNum":" 1361","line":"        typename T,"},
{"lineNum":" 1362","line":"        yoshida_kf_t<T> kf,"},
{"lineNum":" 1363","line":"        int order,"},
{"lineNum":" 1364","line":"        int components >"},
{"lineNum":" 1365","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1366","line":"    void yoshida( T & x, T & xp,"},
{"lineNum":" 1367","line":"                  T & y, T & yp,"},
{"lineNum":" 1368","line":"                  T & cdt, T const & dpop,"},
{"lineNum":" 1369","line":"                  double pref, double m, double step_ref_cdt,"},
{"lineNum":" 1370","line":"                  double step_length, double const* step_strength,"},
{"lineNum":" 1371","line":"                  int steps )"},
{"lineNum":" 1372","line":"    {"},
{"lineNum":" 1373","line":"        const int n = (order - 2) / 2;"},
{"lineNum":" 1374","line":""},
{"lineNum":" 1375","line":"        for(int i = 0; i < steps; ++i)","class":"lineNoCov","hits":"0","possible_hits":"12",},
{"lineNum":" 1376","line":"        {"},
{"lineNum":" 1377","line":"            yoshida_element<T, kf, n, components>::integral(","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":" 1378","line":"                    x, xp, y, yp, cdt, dpop, pref, m, step_ref_cdt,"},
{"lineNum":" 1379","line":"                    step_length, step_strength, steps, 1.0 );"},
{"lineNum":" 1380","line":"        }"},
{"lineNum":" 1381","line":"    }"},
{"lineNum":" 1382","line":""},
{"lineNum":" 1383","line":""},
{"lineNum":" 1384","line":""},
{"lineNum":" 1385","line":""},
{"lineNum":" 1386","line":"    // hardwired 2nd order yoshida"},
{"lineNum":" 1387","line":"    template <"},
{"lineNum":" 1388","line":"        typename T,"},
{"lineNum":" 1389","line":"        yoshida_kf_t<T> kf,"},
{"lineNum":" 1390","line":"        int components >"},
{"lineNum":" 1391","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1392","line":"    void yoshida2(T & x, T & xp,"},
{"lineNum":" 1393","line":"                  T & y, T & yp,"},
{"lineNum":" 1394","line":"                  T & cdt, T const& dpop,"},
{"lineNum":" 1395","line":"                  double reference_momentum,"},
{"lineNum":" 1396","line":"                  double m, double substep_reference_cdt,"},
{"lineNum":" 1397","line":"                  double step_length, double const* step_strength,"},
{"lineNum":" 1398","line":"                  int steps)"},
{"lineNum":" 1399","line":"    {"},
{"lineNum":" 1400","line":"        for(int i = 0; i < steps; ++i)"},
{"lineNum":" 1401","line":"        {"},
{"lineNum":" 1402","line":"            drift_unit(x, xp, y, yp, cdt, dpop,"},
{"lineNum":" 1403","line":"                    0.5 * step_length, reference_momentum,"},
{"lineNum":" 1404","line":"                    m, substep_reference_cdt);"},
{"lineNum":" 1405","line":""},
{"lineNum":" 1406","line":"            kf( x, xp, y, yp, cdt, step_strength );"},
{"lineNum":" 1407","line":""},
{"lineNum":" 1408","line":"            drift_unit(x, xp, y, yp, cdt, dpop,"},
{"lineNum":" 1409","line":"                    0.5 * step_length, reference_momentum,"},
{"lineNum":" 1410","line":"                    m, substep_reference_cdt);"},
{"lineNum":" 1411","line":"        }"},
{"lineNum":" 1412","line":"    }"},
{"lineNum":" 1413","line":""},
{"lineNum":" 1414","line":"    // hardwired 4th order yoshida"},
{"lineNum":" 1415","line":"    template <"},
{"lineNum":" 1416","line":"        typename T,"},
{"lineNum":" 1417","line":"        yoshida_kf_t<T> kf,"},
{"lineNum":" 1418","line":"        int components >"},
{"lineNum":" 1419","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1420","line":"    void yoshida4(T & x, T & xp,"},
{"lineNum":" 1421","line":"                  T & y, T & yp,"},
{"lineNum":" 1422","line":"                  T & cdt, T const& dpop,"},
{"lineNum":" 1423","line":"                  double reference_momentum,"},
{"lineNum":" 1424","line":"                  double m, double step_reference_cdt,"},
{"lineNum":" 1425","line":"                  double step_length, double const* step_strength,"},
{"lineNum":" 1426","line":"                  int steps)"},
{"lineNum":" 1427","line":"    {"},
{"lineNum":" 1428","line":"        // see yoshida4.py for formulas"},
{"lineNum":" 1429","line":"        const double c1 = 0.675603595979828817023843904487;"},
{"lineNum":" 1430","line":"        const double c4 = c1;"},
{"lineNum":" 1431","line":"        const double c2 = -0.175603595979828817023843904487;"},
{"lineNum":" 1432","line":"        const double c3 = c2;"},
{"lineNum":" 1433","line":"        const double d1 = 1.35120719195965763404768780897;"},
{"lineNum":" 1434","line":"        const double d3 = d1;"},
{"lineNum":" 1435","line":"        const double d2 = -1.70241438391931526809537561795;"},
{"lineNum":" 1436","line":""},
{"lineNum":" 1437","line":"        double k1[components * 2], k2[components * 2], k3[components * 2];"},
{"lineNum":" 1438","line":""},
{"lineNum":" 1439","line":"        double substep_reference_cdt = step_reference_cdt * 0.25;"},
{"lineNum":" 1440","line":""},
{"lineNum":" 1441","line":"        for (int i=0; i<components; ++i)"},
{"lineNum":" 1442","line":"        {"},
{"lineNum":" 1443","line":"            k1[i*2+0] = d1 * step_strength[i*2+0];"},
{"lineNum":" 1444","line":"            k1[i*2+1] = d1 * step_strength[i*2+1];"},
{"lineNum":" 1445","line":""},
{"lineNum":" 1446","line":"            k2[i*2+0] = d2 * step_strength[i*2+0];"},
{"lineNum":" 1447","line":"            k2[i*2+1] = d2 * step_strength[i*2+1];"},
{"lineNum":" 1448","line":""},
{"lineNum":" 1449","line":"            k3[i*2+0] = d3 * step_strength[i*2+0];"},
{"lineNum":" 1450","line":"            k3[i*2+1] = d3 * step_strength[i*2+1];"},
{"lineNum":" 1451","line":"        }"},
{"lineNum":" 1452","line":""},
{"lineNum":" 1453","line":"        for(int i = 0; i < steps; ++i)"},
{"lineNum":" 1454","line":"        {"},
{"lineNum":" 1455","line":"            drift_unit(x, xp, y, yp, cdt, dpop, c1 * step_length, reference_momentum,"},
{"lineNum":" 1456","line":"                       m, substep_reference_cdt);"},
{"lineNum":" 1457","line":""},
{"lineNum":" 1458","line":"            //kf( x, xp, y, yp, d1 * step_strength );"},
{"lineNum":" 1459","line":"            kf( x, xp, y, yp, cdt, k1 );"},
{"lineNum":" 1460","line":""},
{"lineNum":" 1461","line":"            drift_unit(x, xp, y, yp, cdt, dpop, c2 * step_length, reference_momentum,"},
{"lineNum":" 1462","line":"                       m, substep_reference_cdt);"},
{"lineNum":" 1463","line":""},
{"lineNum":" 1464","line":"            //kf( x, xp, y, yp, d2 * step_strength );"},
{"lineNum":" 1465","line":"            kf( x, xp, y, yp, cdt, k2 );"},
{"lineNum":" 1466","line":""},
{"lineNum":" 1467","line":"            drift_unit(x, xp, y, yp, cdt, dpop, c3 * step_length, reference_momentum,"},
{"lineNum":" 1468","line":"                       m, substep_reference_cdt);"},
{"lineNum":" 1469","line":""},
{"lineNum":" 1470","line":"            //kf( x, xp, y, yp, d3 * step_strength );"},
{"lineNum":" 1471","line":"            kf( x, xp, y, yp, cdt, k3 );"},
{"lineNum":" 1472","line":""},
{"lineNum":" 1473","line":"            drift_unit(x, xp, y, yp, cdt, dpop, c4 * step_length, reference_momentum,"},
{"lineNum":" 1474","line":"                       m, substep_reference_cdt);"},
{"lineNum":" 1475","line":"        }"},
{"lineNum":" 1476","line":"    }"},
{"lineNum":" 1477","line":""},
{"lineNum":" 1478","line":""},
{"lineNum":" 1479","line":"    // hardwired 6th order yoshida"},
{"lineNum":" 1480","line":"    template <"},
{"lineNum":" 1481","line":"        typename T,"},
{"lineNum":" 1482","line":"        yoshida_kf_t<T> kf,"},
{"lineNum":" 1483","line":"        int components >"},
{"lineNum":" 1484","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1485","line":"    void yoshida6(T & x, T & xp,"},
{"lineNum":" 1486","line":"                  T & y, T & yp,"},
{"lineNum":" 1487","line":"                  T & cdt, T const& dpop,"},
{"lineNum":" 1488","line":"                  double reference_momentum,"},
{"lineNum":" 1489","line":"                  double m, double step_reference_cdt,"},
{"lineNum":" 1490","line":"                  double step_length, double const * step_strength,"},
{"lineNum":" 1491","line":"                  int steps)"},
{"lineNum":" 1492","line":"    {","class":"lineNoCov","hits":"0","possible_hits":"11",},
{"lineNum":" 1493","line":"        // see yoshida4.py for formulas"},
{"lineNum":" 1494","line":"        const double c1 = 0.79361246386112147294625603763;"},
{"lineNum":" 1495","line":"        const double c2 = -0.206276584816439780698721319354;"},
{"lineNum":" 1496","line":"        const double c3 = -0.118008867881292655922412133144;"},
{"lineNum":" 1497","line":"        const double c4 = 0.236949573653050744373598734219;"},
{"lineNum":" 1498","line":""},
{"lineNum":" 1499","line":"        const double d1 = 1.58722492772224294589251207526;"},
{"lineNum":" 1500","line":"        const double d2 = -1.99977809735512250728995471397;"},
{"lineNum":" 1501","line":"        const double d3 = -1.82324266348482825773733634154;"},
{"lineNum":" 1502","line":"        const double d4 = 2.29714181079092974648453380998;"},
{"lineNum":" 1503","line":""},
{"lineNum":" 1504","line":"        // 10 drifts per step"},
{"lineNum":" 1505","line":"        double substep_reference_cdt = step_reference_cdt * 0.1;"},
{"lineNum":" 1506","line":""},
{"lineNum":" 1507","line":"        double k1[components * 2], k2[components * 2], k3[components * 2], k4[components * 2];"},
{"lineNum":" 1508","line":""},
{"lineNum":" 1509","line":"        for (int i=0; i<components; ++i)"},
{"lineNum":" 1510","line":"        {"},
{"lineNum":" 1511","line":"            k1[i*2+0] = d1 * step_strength[i*2+0];","class":"lineNoCov","hits":"0","possible_hits":"14",},
{"lineNum":" 1512","line":"            k1[i*2+1] = d1 * step_strength[i*2+1];","class":"lineNoCov","hits":"0","possible_hits":"12",},
{"lineNum":" 1513","line":""},
{"lineNum":" 1514","line":"            k2[i*2+0] = d2 * step_strength[i*2+0];","class":"lineNoCov","hits":"0","possible_hits":"14",},
{"lineNum":" 1515","line":"            k2[i*2+1] = d2 * step_strength[i*2+1];","class":"lineNoCov","hits":"0","possible_hits":"12",},
{"lineNum":" 1516","line":""},
{"lineNum":" 1517","line":"            k3[i*2+0] = d3 * step_strength[i*2+0];","class":"lineNoCov","hits":"0","possible_hits":"14",},
{"lineNum":" 1518","line":"            k3[i*2+1] = d3 * step_strength[i*2+1];","class":"lineNoCov","hits":"0","possible_hits":"12",},
{"lineNum":" 1519","line":""},
{"lineNum":" 1520","line":"            k4[i*2+0] = d4 * step_strength[i*2+0];","class":"lineNoCov","hits":"0","possible_hits":"14",},
{"lineNum":" 1521","line":"            k4[i*2+1] = d4 * step_strength[i*2+1];","class":"lineNoCov","hits":"0","possible_hits":"12",},
{"lineNum":" 1522","line":"        }"},
{"lineNum":" 1523","line":""},
{"lineNum":" 1524","line":"        for(int i = 0; i < steps; ++i)","class":"lineNoCov","hits":"0","possible_hits":"22",},
{"lineNum":" 1525","line":"        {"},
{"lineNum":" 1526","line":"            drift_unit(x, xp, y, yp, cdt, dpop, c1 * step_length, reference_momentum,","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1527","line":"                       m, substep_reference_cdt);"},
{"lineNum":" 1528","line":""},
{"lineNum":" 1529","line":"            kf( x, xp, y, yp, cdt, k1 );","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1530","line":""},
{"lineNum":" 1531","line":"            drift_unit(x, xp, y, yp, cdt, dpop, c2 * step_length, reference_momentum,","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1532","line":"                       m, substep_reference_cdt);"},
{"lineNum":" 1533","line":""},
{"lineNum":" 1534","line":"            kf( x, xp, y, yp, cdt, k2 );","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1535","line":""},
{"lineNum":" 1536","line":"            drift_unit(x, xp, y, yp, cdt, dpop, c2 * step_length, reference_momentum,","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1537","line":"                       m, substep_reference_cdt);"},
{"lineNum":" 1538","line":""},
{"lineNum":" 1539","line":"            kf( x, xp, y, yp, cdt, k1 );","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1540","line":""},
{"lineNum":" 1541","line":"            drift_unit(x, xp, y, yp, cdt, dpop, c3 * step_length, reference_momentum,","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1542","line":"                       m, substep_reference_cdt);"},
{"lineNum":" 1543","line":""},
{"lineNum":" 1544","line":"            kf( x, xp, y, yp, cdt, k3 );","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1545","line":""},
{"lineNum":" 1546","line":"            drift_unit(x, xp, y, yp, cdt, dpop, c4 * step_length, reference_momentum,","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1547","line":"                       m, substep_reference_cdt);"},
{"lineNum":" 1548","line":""},
{"lineNum":" 1549","line":"            kf( x, xp, y, yp, cdt, k4 );","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1550","line":""},
{"lineNum":" 1551","line":"            drift_unit(x, xp, y, yp, cdt, dpop, c4 * step_length, reference_momentum,","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1552","line":"                       m, substep_reference_cdt);"},
{"lineNum":" 1553","line":""},
{"lineNum":" 1554","line":"            kf( x, xp, y, yp, cdt, k3 );","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1555","line":""},
{"lineNum":" 1556","line":"            drift_unit(x, xp, y, yp, cdt, dpop, c3 * step_length, reference_momentum,","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1557","line":"                       m, substep_reference_cdt);"},
{"lineNum":" 1558","line":""},
{"lineNum":" 1559","line":"            kf( x, xp, y, yp, cdt, k1 );","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1560","line":""},
{"lineNum":" 1561","line":"            drift_unit(x, xp, y, yp, cdt, dpop, c2 * step_length, reference_momentum,","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1562","line":"                       m, substep_reference_cdt);"},
{"lineNum":" 1563","line":""},
{"lineNum":" 1564","line":"            kf( x, xp, y, yp, cdt, k2 );","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1565","line":""},
{"lineNum":" 1566","line":"            drift_unit(x, xp, y, yp, cdt, dpop, c2 * step_length, reference_momentum,","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1567","line":"                       m, substep_reference_cdt);"},
{"lineNum":" 1568","line":""},
{"lineNum":" 1569","line":"            kf( x, xp, y, yp, cdt, k1 );","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1570","line":""},
{"lineNum":" 1571","line":"            drift_unit(x, xp, y, yp, cdt, dpop, c1 * step_length, reference_momentum,","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1572","line":"                       m, substep_reference_cdt);"},
{"lineNum":" 1573","line":"        }"},
{"lineNum":" 1574","line":"    }","class":"lineNoCov","hits":"0","possible_hits":"22",},
{"lineNum":" 1575","line":""},
{"lineNum":" 1576","line":""},
{"lineNum":" 1577","line":"    namespace yoshida_constants"},
{"lineNum":" 1578","line":"    {"},
{"lineNum":" 1579","line":"        // see yoshida4.py for formulas"},
{"lineNum":" 1580","line":"        namespace bend_yoshida6"},
{"lineNum":" 1581","line":"        {"},
{"lineNum":" 1582","line":"            const double c1 = 0.79361246386112147294625603763;"},
{"lineNum":" 1583","line":"            const double c2 = -0.206276584816439780698721319354;"},
{"lineNum":" 1584","line":"            const double c3 = -0.118008867881292655922412133144;"},
{"lineNum":" 1585","line":"            const double c4 = 0.236949573653050744373598734219;"},
{"lineNum":" 1586","line":""},
{"lineNum":" 1587","line":"            const double d1 = 1.58722492772224294589251207526;"},
{"lineNum":" 1588","line":"            const double d2 = -1.99977809735512250728995471397;"},
{"lineNum":" 1589","line":"            const double d3 = -1.82324266348482825773733634154;"},
{"lineNum":" 1590","line":"            const double d4 = 2.29714181079092974648453380998;"},
{"lineNum":" 1591","line":"        }"},
{"lineNum":" 1592","line":"    }"},
{"lineNum":" 1593","line":""},
{"lineNum":" 1594","line":"    template <"},
{"lineNum":" 1595","line":"        typename T,"},
{"lineNum":" 1596","line":"        void(kf)(T const & x, T & xp, T const & y, T & yp, double r0, double const * kL),"},
{"lineNum":" 1597","line":"        int components >"},
{"lineNum":" 1598","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1599","line":"    void bend_yoshida4(T & x, T & xp,"},
{"lineNum":" 1600","line":"                       T & y, T & yp,"},
{"lineNum":" 1601","line":"                       T & cdt, T const& dpop,"},
{"lineNum":" 1602","line":"                       double reference_momentum,"},
{"lineNum":" 1603","line":"                       double m, double step_reference_cdt,"},
{"lineNum":" 1604","line":"                       double step_angle, double const* step_strength,"},
{"lineNum":" 1605","line":"                       double r0, double bend_strength,"},
{"lineNum":" 1606","line":"                       int steps)"},
{"lineNum":" 1607","line":"    {"},
{"lineNum":" 1608","line":"#if 0"},
{"lineNum":" 1609","line":"        // see yoshida4.py for formulas"},
{"lineNum":" 1610","line":"        const double c1 = 0.675603595979828817023843904487;"},
{"lineNum":" 1611","line":"        const double c4 = c1;"},
{"lineNum":" 1612","line":"        const double c2 = -0.175603595979828817023843904487;"},
{"lineNum":" 1613","line":"        const double c3 = c2;"},
{"lineNum":" 1614","line":"        const double d1 = 1.35120719195965763404768780897;"},
{"lineNum":" 1615","line":"        const double d3 = d1;"},
{"lineNum":" 1616","line":"        const double d2 = -1.70241438391931526809537561795;"},
{"lineNum":" 1617","line":""},
{"lineNum":" 1618","line":"        double k1[components * 2], k2[components * 2], k3[components * 2];"},
{"lineNum":" 1619","line":""},
{"lineNum":" 1620","line":"        double substep_reference_cdt = step_reference_cdt * 0.25;"},
{"lineNum":" 1621","line":""},
{"lineNum":" 1622","line":"        for (int i=0; i<components; ++i)"},
{"lineNum":" 1623","line":"        {"},
{"lineNum":" 1624","line":"            k1[i*2+0] = d1 * step_strength[i*2+0];"},
{"lineNum":" 1625","line":"            k1[i*2+1] = d1 * step_strength[i*2+1];"},
{"lineNum":" 1626","line":""},
{"lineNum":" 1627","line":"            k2[i*2+0] = d2 * step_strength[i*2+0];"},
{"lineNum":" 1628","line":"            k2[i*2+1] = d2 * step_strength[i*2+1];"},
{"lineNum":" 1629","line":""},
{"lineNum":" 1630","line":"            k3[i*2+0] = d3 * step_strength[i*2+0];"},
{"lineNum":" 1631","line":"            k3[i*2+1] = d3 * step_strength[i*2+1];"},
{"lineNum":" 1632","line":"        }"},
{"lineNum":" 1633","line":""},
{"lineNum":" 1634","line":"        static double ssd = 0.0;"},
{"lineNum":" 1635","line":"        static double sr0 = 0.0;"},
{"lineNum":" 1636","line":""},
{"lineNum":" 1637","line":"        static std::complex<double> step_phase[0] = bend_unit_phase(c1 * ssd);"},
{"lineNum":" 1638","line":"        static std::complex<double> step_phase[1] = bend_unit_phase(c2 * ssd);"},
{"lineNum":" 1639","line":"        static std::complex<double> step_phase[2] = bend_unit_phase(c3 * ssd);"},
{"lineNum":" 1640","line":"        static std::complex<double> step_phase[3] = bend_unit_phase(c4 * ssd);"},
{"lineNum":" 1641","line":""},
{"lineNum":" 1642","line":"        static std::complex<double> step_term[0] = bend_unit_term(sr0, c1 * ssd);"},
{"lineNum":" 1643","line":"        static std::complex<double> step_term[1] = bend_unit_term(sr0, c2 * ssd);"},
{"lineNum":" 1644","line":"        static std::complex<double> step_term[2] = bend_unit_term(sr0, c3 * ssd);"},
{"lineNum":" 1645","line":"        static std::complex<double> step_term[3] = bend_unit_term(sr0, c4 * ssd);"},
{"lineNum":" 1646","line":""},
{"lineNum":" 1647","line":"        double theta = step_angle;"},
{"lineNum":" 1648","line":""},
{"lineNum":" 1649","line":"        if (theta != ssd)"},
{"lineNum":" 1650","line":"        {"},
{"lineNum":" 1651","line":"            // updates both phase and term"},
{"lineNum":" 1652","line":"            step_phase[0] = bend_unit_phase(c1 * theta);"},
{"lineNum":" 1653","line":"            step_phase[1] = bend_unit_phase(c2 * theta);"},
{"lineNum":" 1654","line":"            step_phase[2] = bend_unit_phase(c3 * theta);"},
{"lineNum":" 1655","line":"            step_phase[3] = bend_unit_phase(c4 * theta);"},
{"lineNum":" 1656","line":""},
{"lineNum":" 1657","line":"            step_term[0] = bend_unit_term(r0, c1 * theta);"},
{"lineNum":" 1658","line":"            step_term[1] = bend_unit_term(r0, c2 * theta);"},
{"lineNum":" 1659","line":"            step_term[2] = bend_unit_term(r0, c3 * theta);"},
{"lineNum":" 1660","line":"            step_term[3] = bend_unit_term(r0, c4 * theta);"},
{"lineNum":" 1661","line":""},
{"lineNum":" 1662","line":"            ssd = theta;"},
{"lineNum":" 1663","line":"            sr0 = r0;"},
{"lineNum":" 1664","line":"        }"},
{"lineNum":" 1665","line":"        else if (r0 != sr0)"},
{"lineNum":" 1666","line":"        {"},
{"lineNum":" 1667","line":"            // update term only"},
{"lineNum":" 1668","line":"            step_term[0] = bend_unit_term(r0, c1 * theta);"},
{"lineNum":" 1669","line":"            step_term[1] = bend_unit_term(r0, c2 * theta);"},
{"lineNum":" 1670","line":"            step_term[2] = bend_unit_term(r0, c3 * theta);"},
{"lineNum":" 1671","line":"            step_term[3] = bend_unit_term(r0, c4 * theta);"},
{"lineNum":" 1672","line":""},
{"lineNum":" 1673","line":"            sr0 = r0;"},
{"lineNum":" 1674","line":"        }"},
{"lineNum":" 1675","line":""},
{"lineNum":" 1676","line":"        for(int i = 0; i < steps; ++i)"},
{"lineNum":" 1677","line":"        {"},
{"lineNum":" 1678","line":"            bend_unit(x, xp, y, yp, cdt, dpop, - c1 * step_angle, bend_strength, reference_momentum,"},
{"lineNum":" 1679","line":"                       m, substep_reference_cdt, step_phase[0], step_term[0]);"},
{"lineNum":" 1680","line":""},
{"lineNum":" 1681","line":"            kf( x, xp, y, yp, r0, k1 );"},
{"lineNum":" 1682","line":""},
{"lineNum":" 1683","line":"            bend_unit(x, xp, y, yp, cdt, dpop, - c2 * step_angle, bend_strength, reference_momentum,"},
{"lineNum":" 1684","line":"                       m, substep_reference_cdt, step_phase[1], step_term[1]);"},
{"lineNum":" 1685","line":""},
{"lineNum":" 1686","line":"            kf( x, xp, y, yp, r0, k2 );"},
{"lineNum":" 1687","line":""},
{"lineNum":" 1688","line":"            bend_unit(x, xp, y, yp, cdt, dpop, - c3 * step_angle, bend_strength, reference_momentum,"},
{"lineNum":" 1689","line":"                       m, substep_reference_cdt, step_phase[2], step_term[2]);"},
{"lineNum":" 1690","line":""},
{"lineNum":" 1691","line":"            kf( x, xp, y, yp, r0, k3 );"},
{"lineNum":" 1692","line":""},
{"lineNum":" 1693","line":"            bend_unit(x, xp, y, yp, cdt, dpop, - c4 * step_angle, bend_strength, reference_momentum,"},
{"lineNum":" 1694","line":"                       m, substep_reference_cdt, step_phase[3], step_term[3]);"},
{"lineNum":" 1695","line":"        }"},
{"lineNum":" 1696","line":"#endif"},
{"lineNum":" 1697","line":"    }"},
{"lineNum":" 1698","line":""},
{"lineNum":" 1699","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1700","line":"    Kokkos::complex<double> sbend_unit_phase(double c, double delta)"},
{"lineNum":" 1701","line":"    { return bend_unit_phase(c * delta); }","class":"lineNoCov","hits":"0","possible_hits":"12",},
{"lineNum":" 1702","line":""},
{"lineNum":" 1703","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1704","line":"    Kokkos::complex<double> rbend_unit_phase(double c, double delta)"},
{"lineNum":" 1705","line":"    { return bend_unit_phase(0.0); }"},
{"lineNum":" 1706","line":""},
{"lineNum":" 1707","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1708","line":"    Kokkos::complex<double> sbend_unit_term (double c, double delta, double r0)"},
{"lineNum":" 1709","line":"    { return bend_unit_term(r0, c * delta); }","class":"lineNoCov","hits":"0","possible_hits":"8",},
{"lineNum":" 1710","line":""},
{"lineNum":" 1711","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1712","line":"    Kokkos::complex<double> rbend_unit_term (double c, double delta, double r0)"},
{"lineNum":" 1713","line":"    { return c * delta; }"},
{"lineNum":" 1714","line":""},
{"lineNum":" 1715","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1716","line":"    double sbend_dphi(double c, double delta)"},
{"lineNum":" 1717","line":"    { return - c * delta; }","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1718","line":""},
{"lineNum":" 1719","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1720","line":"    double rbend_dphi(double c, double delta)"},
{"lineNum":" 1721","line":"    { return 0.0; }"},
{"lineNum":" 1722","line":""},
{"lineNum":" 1723","line":"#if 1"},
{"lineNum":" 1724","line":"    // hardwired 6th order yoshida"},
{"lineNum":" 1725","line":"    template <"},
{"lineNum":" 1726","line":"        typename T,"},
{"lineNum":" 1727","line":"        void(f_kf)(T const & x, T & xp, T const & y, T & yp, double r0, double const * kL),   // kick"},
{"lineNum":" 1728","line":"        int components >"},
{"lineNum":" 1729","line":"    KOKKOS_INLINE_FUNCTION"},
{"lineNum":" 1730","line":"    void bend_yoshida6(T & x, T & xp,"},
{"lineNum":" 1731","line":"                       T & y, T & yp,"},
{"lineNum":" 1732","line":"                       T & cdt, T const& dpop,"},
{"lineNum":" 1733","line":"                       double reference_momentum,"},
{"lineNum":" 1734","line":"                       double m, double step_reference_cdt,"},
{"lineNum":" 1735","line":"                       double const * step_strength,"},
{"lineNum":" 1736","line":"                       double const * dphi,"},
{"lineNum":" 1737","line":"                       Kokkos::complex<double> const * step_phase,"},
{"lineNum":" 1738","line":"                       Kokkos::complex<double> const * step_term,"},
{"lineNum":" 1739","line":"                       double r0, double bend_strength,"},
{"lineNum":" 1740","line":"                       int steps)"},
{"lineNum":" 1741","line":"    {","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1742","line":"        // see yoshida4.py for formulas"},
{"lineNum":" 1743","line":"        namespace by6 = yoshida_constants::bend_yoshida6;"},
{"lineNum":" 1744","line":""},
{"lineNum":" 1745","line":"        // 10 drifts per step"},
{"lineNum":" 1746","line":"        double substep_reference_cdt = step_reference_cdt * 0.1;"},
{"lineNum":" 1747","line":""},
{"lineNum":" 1748","line":"        double k1[components * 2], k2[components * 2], k3[components * 2], k4[components * 2];"},
{"lineNum":" 1749","line":""},
{"lineNum":" 1750","line":"        for (int i=0; i<components; ++i)"},
{"lineNum":" 1751","line":"        {"},
{"lineNum":" 1752","line":"            k1[i*2+0] = by6::d1 * step_strength[i*2+0];","class":"lineNoCov","hits":"0","possible_hits":"15",},
{"lineNum":" 1753","line":"            k1[i*2+1] = by6::d1 * step_strength[i*2+1];"},
{"lineNum":" 1754","line":""},
{"lineNum":" 1755","line":"            k2[i*2+0] = by6::d2 * step_strength[i*2+0];","class":"lineNoCov","hits":"0","possible_hits":"15",},
{"lineNum":" 1756","line":"            k2[i*2+1] = by6::d2 * step_strength[i*2+1];"},
{"lineNum":" 1757","line":""},
{"lineNum":" 1758","line":"            k3[i*2+0] = by6::d3 * step_strength[i*2+0];","class":"lineNoCov","hits":"0","possible_hits":"15",},
{"lineNum":" 1759","line":"            k3[i*2+1] = by6::d3 * step_strength[i*2+1];"},
{"lineNum":" 1760","line":""},
{"lineNum":" 1761","line":"            k4[i*2+0] = by6::d4 * step_strength[i*2+0];","class":"lineNoCov","hits":"0","possible_hits":"15",},
{"lineNum":" 1762","line":"            k4[i*2+1] = by6::d4 * step_strength[i*2+1];"},
{"lineNum":" 1763","line":"        }"},
{"lineNum":" 1764","line":""},
{"lineNum":" 1765","line":"        for(int i = 0; i < steps; ++i)","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":" 1766","line":"        {"},
{"lineNum":" 1767","line":"            //drift_unit(x, xp, y, yp, cdt, dpop, c1 * step_length, reference_momentum,"},
{"lineNum":" 1768","line":"            //          m, substep_reference_cdt);"},
{"lineNum":" 1769","line":""},
{"lineNum":" 1770","line":"            bend_unit<T>(x, xp, y, yp, cdt, dpop, dphi[0] , bend_strength, reference_momentum,","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1771","line":"                       m, substep_reference_cdt, step_phase[0], step_term[0]);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1772","line":""},
{"lineNum":" 1773","line":"            f_kf( x, xp, y, yp, r0, k1 );","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1774","line":""},
{"lineNum":" 1775","line":"            //drift_unit(x, xp, y, yp, cdt, dpop, c2 * step_length, reference_momentum,"},
{"lineNum":" 1776","line":"            //           m, substep_reference_cdt);"},
{"lineNum":" 1777","line":""},
{"lineNum":" 1778","line":"            bend_unit<T>(x, xp, y, yp, cdt, dpop, dphi[1], bend_strength, reference_momentum,","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1779","line":"                       m, substep_reference_cdt, step_phase[1], step_term[1]);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1780","line":""},
{"lineNum":" 1781","line":"            f_kf( x, xp, y, yp, r0, k2 );","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1782","line":""},
{"lineNum":" 1783","line":"            //drift_unit(x, xp, y, yp, cdt, dpop, c2 * step_length, reference_momentum,"},
{"lineNum":" 1784","line":"            //           m, substep_reference_cdt);"},
{"lineNum":" 1785","line":""},
{"lineNum":" 1786","line":"            bend_unit<T>(x, xp, y, yp, cdt, dpop, dphi[1], bend_strength, reference_momentum,","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1787","line":"                       m, substep_reference_cdt, step_phase[1], step_term[1]);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1788","line":""},
{"lineNum":" 1789","line":"            f_kf( x, xp, y, yp, r0, k1 );","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1790","line":""},
{"lineNum":" 1791","line":"            //drift_unit(x, xp, y, yp, cdt, dpop, c3 * step_length, reference_momentum,"},
{"lineNum":" 1792","line":"            //           m, substep_reference_cdt);"},
{"lineNum":" 1793","line":""},
{"lineNum":" 1794","line":"            bend_unit<T>(x, xp, y, yp, cdt, dpop, dphi[2], bend_strength, reference_momentum,","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1795","line":"                       m, substep_reference_cdt, step_phase[2], step_term[2]);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1796","line":""},
{"lineNum":" 1797","line":"            f_kf( x, xp, y, yp, r0, k3 );","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1798","line":""},
{"lineNum":" 1799","line":"            //drift_unit(x, xp, y, yp, cdt, dpop, c4 * step_length, reference_momentum,"},
{"lineNum":" 1800","line":"            //           m, substep_reference_cdt);"},
{"lineNum":" 1801","line":""},
{"lineNum":" 1802","line":"            bend_unit<T>(x, xp, y, yp, cdt, dpop, dphi[3], bend_strength, reference_momentum,","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1803","line":"                       m, substep_reference_cdt, step_phase[3], step_term[3]);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1804","line":""},
{"lineNum":" 1805","line":"            f_kf( x, xp, y, yp, r0, k4 );","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1806","line":""},
{"lineNum":" 1807","line":"            //drift_unit(x, xp, y, yp, cdt, dpop, c4 * step_length, reference_momentum,"},
{"lineNum":" 1808","line":"            //           m, substep_reference_cdt);"},
{"lineNum":" 1809","line":""},
{"lineNum":" 1810","line":"            bend_unit<T>(x, xp, y, yp, cdt, dpop, dphi[3], bend_strength, reference_momentum,","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1811","line":"                       m, substep_reference_cdt, step_phase[3], step_term[3]);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1812","line":""},
{"lineNum":" 1813","line":"            f_kf( x, xp, y, yp, r0, k3 );","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1814","line":""},
{"lineNum":" 1815","line":"            //drift_unit(x, xp, y, yp, cdt, dpop, c3 * step_length, reference_momentum,"},
{"lineNum":" 1816","line":"            //           m, substep_reference_cdt);"},
{"lineNum":" 1817","line":""},
{"lineNum":" 1818","line":"            bend_unit<T>(x, xp, y, yp, cdt, dpop, dphi[2], bend_strength, reference_momentum,","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1819","line":"                       m, substep_reference_cdt, step_phase[2], step_term[2]);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1820","line":""},
{"lineNum":" 1821","line":"            f_kf( x, xp, y, yp, r0, k1 );","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1822","line":""},
{"lineNum":" 1823","line":"            //drift_unit(x, xp, y, yp, cdt, dpop, c2 * step_length, reference_momentum,"},
{"lineNum":" 1824","line":"            //           m, substep_reference_cdt);"},
{"lineNum":" 1825","line":""},
{"lineNum":" 1826","line":"            bend_unit<T>(x, xp, y, yp, cdt, dpop, dphi[1], bend_strength, reference_momentum,","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1827","line":"                       m, substep_reference_cdt, step_phase[1], step_term[1]);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1828","line":""},
{"lineNum":" 1829","line":"            f_kf( x, xp, y, yp, r0, k2 );","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1830","line":""},
{"lineNum":" 1831","line":"            //drift_unit(x, xp, y, yp, cdt, dpop, c2 * step_length, reference_momentum,"},
{"lineNum":" 1832","line":"            //           m, substep_reference_cdt);"},
{"lineNum":" 1833","line":""},
{"lineNum":" 1834","line":"            bend_unit<T>(x, xp, y, yp, cdt, dpop, dphi[1], bend_strength, reference_momentum,","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1835","line":"                       m, substep_reference_cdt, step_phase[1], step_term[1]);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1836","line":""},
{"lineNum":" 1837","line":"            f_kf( x, xp, y, yp, r0, k1 );","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1838","line":""},
{"lineNum":" 1839","line":"            //drift_unit(x, xp, y, yp, cdt, dpop, c1 * step_length, reference_momentum,"},
{"lineNum":" 1840","line":"            //           m, substep_reference_cdt);"},
{"lineNum":" 1841","line":""},
{"lineNum":" 1842","line":"            bend_unit<T>(x, xp, y, yp, cdt, dpop, dphi[0], bend_strength, reference_momentum,","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":" 1843","line":"                       m, substep_reference_cdt, step_phase[0], step_term[0]);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":" 1844","line":""},
{"lineNum":" 1845","line":"        }"},
{"lineNum":" 1846","line":"    }","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":" 1847","line":""},
{"lineNum":" 1848","line":"#endif"},
{"lineNum":" 1849","line":""},
{"lineNum":" 1850","line":"};"},
{"lineNum":" 1851","line":""},
{"lineNum":" 1852","line":""},
{"lineNum":" 1853","line":""},
{"lineNum":" 1854","line":"#endif // FF_ALGORITHM_H"},
]};
var percent_low = 25;var percent_high = 75;
var header = { "command" : "fodo_cxx", "date" : "2021-12-15 09:03:42", "instrumented" : 415, "covered" : 0,};
var merged_data = [];
